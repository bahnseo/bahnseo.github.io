<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ í™ˆí˜ì´ì§€ ëŒ€ì‹œë³´ë“œ</title>

    <!-- [ì‹ ê·œ] ë¸Œë¼ìš°ì € íƒ­ ì•„ì´ì½˜ (Favicon) ì¶”ê°€ -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="Icon_32x32-WWW.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <!-- / [ìˆ˜ì •] PNG íŒŒì¼ ì˜ˆì‹œë¡œ ë³€ê²½ -->


    <!-- 1. ê¹œë¹¡ì„ ë°©ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

    <!-- 2. Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 3. Tailwind ì„¤ì • -->
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    
    <!-- 4. SortableJS CDN (Drag and Drop) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- [ì‹ ê·œ] Google API Client Library -->
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    
    <style>
        /* Inter í°íŠ¸ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš© */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
            transition: zoom 0.2s ease-in-out, font-family 0.2s ease-in-out; /* [ìˆ˜ì •] í°íŠ¸ ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ ì¶”ê°€ */
            /* [ì œê±°] ìƒë‹¨ ê³ ì • ë‚´ë¹„ê²Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ padding-top ì œê±° */
        }
        /* ë‹¤í¬ ëª¨ë“œ ìŠ¤í¬ë¡¤ë°” */
        .dark ::-webkit-scrollbar { width: 12px; }
        .dark ::-webkit-scrollbar-track { background: #1f2937; }
        .dark ::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 6px; border: 3px solid #1f2937; }

        /* [ì¶”ê°€] ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            transition: opacity 0.2s ease-in-out;
        }
        .modal-content {
            transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out;
        }
        .modal-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .modal-hidden .modal-content {
            transform: scale(0.95);
            opacity: 0;
        }

        /* [ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .toast {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear;
        }
        .toast.show {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s linear;
        }
        /* [ìˆ˜ì •] í† ìŠ¤íŠ¸ ì—ëŸ¬ ìŠ¤íƒ€ì¼ */
        .toast.error {
            background-color: #dc2626; /* red-600 */
        }

        /* [ì¶”ê°€] ì„¤ì • ëª¨ë“œì¼ ë•Œë§Œ ë³´ì´ëŠ” UI */
        .edit-controls {
            display: none;
        }
        /* [ìˆ˜ì •] .edit-controls-inline ê¸°ë³¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .edit-controls-inline {
            display: none;
        }
        .edit-mode .edit-controls {
            display: flex; /* flex ë˜ëŠ” block ë“± */
            flex-direction: column; /* [ì¶”ê°€] for 'flex-col' */
            gap: 1rem; /* [ì¶”ê°€] for 'gap-4' (1rem = 16px) */
        }
        .edit-mode .edit-controls-inline {
            display: inline-flex;
        }
        /* ì„¤ì • ëª¨ë“œì¼ ë•Œ ì¹´ë“œ ìœ„ì— ë²„íŠ¼ í‘œì‹œ */
        .site-card .edit-card-controls {
            display: none;
        }
        .edit-mode .site-card .edit-card-controls {
            display: flex;
        }

        /* [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .search-engine-label {
            background-color: white; /* bg-white */
            color: #374151; /* text-gray-700 */
            transition: all 0.2s ease-in-out;
        }
        .dark .search-engine-label {
            background-color: #374151; /* dark:bg-gray-700 */
            color: #D1D5DB; /* dark:text-gray-300 */
        }
        input[type="radio"]:checked + .search-engine-label {
            background-color: #3B82F6; /* bg-blue-600 */
            color: white; /* text-white */
            border-color: #3B82F6; /* border-blue-600 */
            z-index: 10;
        }
        .dark input[type="radio"]:checked + .search-engine-label {
            background-color: #3B82F6; /* dark:bg-blue-600 */
            color: white; /* dark:text-white */
            border-color: #3B82F6; /* dark:border-blue-600 */
        }

        /* [ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .ghost-category {
            opacity: 0.5;
            background: #e0e7ff; /* indigo-100 */
        }
        .dark .ghost-category {
            background: #3730a3; /* indigo-900 */
        }
        .ghost-card {
            opacity: 0.5;
            background: #dbeafe; /* blue-100 */
        }
        .dark .ghost-card {
            background: #1e3a8a; /* blue-900 */
        }
        .category-title-wrapper.cursor-move {
            cursor: move;
        }
        .site-card.cursor-move {
            cursor: move;
        }

        /* [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ì¶”ê°€] í°íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .font-selector {
            width: 100%;
            padding: 0.75rem 1rem; /* py-3 px-4 */
            border: 1px solid #D1D5DB; /* border-gray-300 */
            background-color: #FFFFFF; /* bg-white */
            color: #1F2937; /* text-gray-900 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            appearance: none; /* ê¸°ë³¸ í™”ì‚´í‘œ ì œê±° */
            /* Tailwind 'chevron-down' icon encoded for data URI */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem; /* í™”ì‚´í‘œ ê³µê°„ í™•ë³´ */
        }
        .dark .font-selector {
            border-color: #4B5563; /* dark:border-gray-600 */
            background-color: #374151; /* dark:bg-gray-700 */
            color: #F9FAFB; /* dark:text-gray-100 */
            /* Dark mode chevron color */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23D1D5DB'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
        }
        
        /* [ì¶”ê°€] ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ ìŠ¤íƒ€ì¼ */
        .category-nav-item {
            /* íƒ­ ìŠ¤íƒ€ì¼ */
            /* [ì œê±°] white-space: nowrap; - ì¤„ë°”ê¿ˆì„ í—ˆìš©í•˜ê¸° ìœ„í•´ ì œê±° */
            padding: 0.5rem 1rem;
            border-radius: 0.5rem; /* [ìˆ˜ì •] ì‚¬ë°©ì„ ë‘¥ê¸€ê²Œ */
            transition: all 0.2s ease-in-out;
            border-bottom: 2px solid transparent;
            color: #6B7280; /* text-gray-500 */
        }
        .dark .category-nav-item {
             color: #9CA3AF; /* dark:text-gray-400 */
        }
        .category-nav-item:hover {
            color: #3B82F6; /* text-blue-500 */
            background-color: #F3F4F6; /* bg-gray-100 */
        }
        .dark .category-nav-item:hover {
            color: #60A5FA; /* dark:text-blue-400 */
            background-color: #374151; /* dark:bg-gray-700 */
        }
        /* í˜„ì¬ í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ (ì„ íƒ ì‹œ ê°•ì œ ìŠ¤íƒ€ì¼) */
        .category-nav-item.active {
            color: #3B82F6; /* text-blue-500 */
            font-weight: 600; /* font-semibold */
            border-bottom-color: #3B82F6; /* border-blue-500 */
            background-color: #f3f4f6; /* [ì¶”ê°€] í™œì„±í™” ì‹œ ë°°ê²½ìƒ‰ ê°•ì¡° */
        }
        .dark .category-nav-item.active {
            color: #60A5FA; /* dark:text-blue-400 */
            border-bottom-color: #60A5FA; /* dark:border-blue-400 */
            background-color: #374151; /* [ì¶”ê°€] í™œì„±í™” ì‹œ ë°°ê²½ìƒ‰ ê°•ì¡° */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- [ì œê±°] ìƒë‹¨ ê³ ì • ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ (ì•„ë˜ë¡œ ì´ë™) -->
    
    <!-- ì „ì²´ ì»¨í…Œì´ë„ˆ -->
    <!-- [ìˆ˜ì •] sm:px-4ë¥¼ ìœ ì§€í•˜ì—¬ ëª¨ë°”ì¼ì—ì„œëŠ” íŒ¨ë”©ì´ ì—†ìŠµë‹ˆë‹¤. -->
    <div class="min-h-screen container mx-auto py-8 md:py-12 sm:px-4"> 

        <!-- 1. í—¤ë” ì˜ì—­ -->
        <!-- [ê°œì„ ] í—¤ë”ì— ëª¨ë°”ì¼ íŒ¨ë”©ì„ ì¶”ê°€í•˜ì—¬ ë‚´ìš©ì´ ì»¨í…Œì´ë„ˆì˜ ê°€ì¥ìë¦¬ë¡œ ë¶™ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤. -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 md:mb-12 gap-4 px-4 sm:px-0">
            <!-- [ìˆ˜ì •] ëŒ€ì‹œë³´ë“œ ì œëª© ì˜ì—­ -->
            <div class="text-center md:text-left">
                <div class="flex items-center justify-center md:justify-start gap-2">
                    <h1 id="dashboard-title" class="text-3xl font-bold text-blue-600 dark:text-blue-400">My Dashboard</h1>
                    <!-- [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì • ë²„íŠ¼ (ì„¤ì • ëª¨ë“œ) -->
                    <button id="edit-title-btn" class="edit-controls-inline p-1 text-blue-500 hover:text-blue-700" title="ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì •">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                    </button>
                </div>
                <p id="currentTime" class="text-lg text-gray-600 dark:text-gray-400">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

                <!-- [ìˆ˜ì •] ì¢ì€ í™”ë©´ì—ì„œ ê²€ìƒ‰ í¼ê³¼ í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼ì´ ì„¸ë¡œë¡œ ìŒ“ì´ë„ë¡ flex-col sm:flex-rowë¡œ ë³€ê²½ -->
            <div class="flex flex-col sm:flex-row items-center gap-4 sm:gap-2">
                
                <!-- 1. Site Filter Input Block (now contains the button) -->
                <div class="flex flex-col w-full sm:w-auto">
                    <button type="button" id="toggle-site-search-btn" class="px-1.5 py-1.0 rounded-lg border bg-blue-600 hover:bg-blue-700 text-white border-blue-600 cursor-pointer text-xs w-1/2 sm:w-32 md:w-32 ml-auto mb-1">ì‚¬ì´íŠ¸ ê²€ìƒ‰</button>
                    <input type="text" id="site-filter-input" placeholder="ì‚¬ì´íŠ¸ ê²€ìƒ‰..." class="px-4 py-2 w-full sm:w-64 md:w-64 border-2 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:focus:border-blue-400 transition-colors">
                </div>

                <!-- [ìˆ˜ì •] ê²€ìƒ‰ í¼ ë° ì—”ì§„ ì„ íƒê¸° (ëª¨ë°”ì¼ì—ì„œ ìœ ì—°í•˜ê²Œ ì¤„ì–´ë“¤ë„ë¡ w-full ì ìš©) -->
                <div class="flex flex-col items-end w-full sm:w-auto">
                    <!-- [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„ íƒ -->
                    <div class="flex rounded-lg mb-1" role="radiogroup">
                        <input type="radio" id="search-engine-google" name="search-engine" value="google" class="hidden" checked>
                        <!-- [ìˆ˜ì •] padding (py-1.5 -> py-0.5, px-3 -> px-1.5) -->
                        <label for="search-engine-google" class="search-engine-label px-1.5 py-1.0 rounded-l-md border border-gray-300 dark:border-gray-600 cursor-pointer text-xs">google</label>
                        
                        <input type="radio" id="search-engine-naver" name="search-engine" value="naver" class="hidden">
                        <!-- [ìˆ˜ì •] padding (py-1.5 -> py-0.5, px-3 -> px-1.5) -->
                        <label for="search-engine-naver" class="search-engine-label px-1.5 py-1.0 rounded-r-md border border-gray-300 dark:border-gray-600 cursor-pointer -ml-px text-xs">naver</label>
                    </div>
                
                    <!-- [ìˆ˜ì •] ê²€ìƒ‰ í¼ (w-full ì ìš© ë° inputë„ w-fullë¡œ ì„¤ì •í•˜ì—¬ ìœ ì—°í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤) -->
                    <form id="search-form" action="https://www.google.com/search" method="GET" target="_blank" class="flex items-center w-full sm:w-auto">
                        <!-- [ìˆ˜ì •] w-fullì„ ì‚¬ìš©í•˜ì—¬ ë‚¨ì€ ê³µê°„ì„ ëª¨ë‘ ì°¨ì§€í•˜ë„ë¡ í•¨ -->
                        <input type="text" id="search-input" name="q" placeholder="Google ê²€ìƒ‰..." class="px-4 py-2 w-full sm:w-64 md:w-64 border-2 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-l-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:focus:border-blue-400">
                        <button type="submit" class="flex-shrink-0 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-r-lg transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </button>
                    </form>
                </div>

                <!-- [ìˆ˜ì •] í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼ (í—¤ë”ì— ìœ ì§€) -->
                <div class="flex items-center gap-0.5 p-0.5 rounded-lg bg-gray-200 dark:bg-gray-700 flex-shrink-0">
                    <button id="zoom-out-btn" class="p-1 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" title="í™”ë©´ ì¶•ì†Œ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8zm3 3a1 1 0 011-1h4a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="zoom-reset-btn" class="px-1.5 py-1 text-xs font-semibold rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors w-12 text-center" title="í™•ëŒ€/ì¶•ì†Œ ì´ˆê¸°í™”">
                        100%
                    </button>
                    <button id="zoom-in-btn" class="p-1 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" title="í™”ë©´ í™•ëŒ€">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8zm8-3a1 1 0 011 1v2h2a1 1 0 110 2h-2v2a1 1 0 11-2 0v-2H7a1 1 0 110-2h2V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- [ìˆ˜ì •] ì„¤ì •/í…Œë§ˆ ë²„íŠ¼ì€ ì•„ë˜ í”Œë¡œíŒ… ì»¨í…Œì´ë„ˆë¡œ ì´ë™í•˜ê³ , ì´ ìë¦¬ì—ëŠ” ê³µê°„ë§Œ ë‚¨ê¹ë‹ˆë‹¤. -->
                <div class="hidden md:flex items-center gap-2 sm:gap-4">
                    <!-- Placeholder for the space formerly occupied by settings/theme buttons -->
                </div>
            			</div>        </header>
            
                    <!-- [ì‹ ê·œ] D-Day ë° ì•Œë¦¼ ìš”ì•½ ë°•ìŠ¤ -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-8 md:mb-12 px-4 sm:px-0">
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-blue-600 dark:text-blue-400 mb-2">D-Day</h3>
                            <div id="dday-summary-box" class="text-sm space-y-1 text-gray-700 dark:text-gray-300">
                                <p class="text-gray-500">í‘œì‹œí•  D-Dayê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold text-green-600 dark:text-green-400 mb-2">Upcoming Notifications (3ì¼ ì´ë‚´)</h3>
                            <div id="alarm-summary-box" class="text-sm space-y-1 text-gray-700 dark:text-gray-300">
                                <p class="text-gray-500">3ì¼ ì´ë‚´ì˜ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        </div>
                    </div>

                                        <!-- [ì‹ ê·œ] 1.5. ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ (ì¤„ë°”ê¿ˆ ë°©ì‹, í—¤ë” ì•„ë˜ë¡œ ì´ë™) -->
                                                                    <nav id="category-nav-wrapper" class="w-full bg-white dark:bg-gray-800 shadow-md border-b border-gray-200 dark:border-gray-700 rounded-lg mb-8 md:mb-12 px-4 sm:px-0">            <!-- [ìˆ˜ì •] flex-wrapì„ ì¶”ê°€í•˜ê³  overflow-x-autoë¥¼ ì œê±°í•˜ì—¬ ì¤„ë°”ê¿ˆì„ í—ˆìš©í•©ë‹ˆë‹¤. -->
                                                                        <div id="category-nav" class="flex flex-wrap gap-2 p-3">
                                                                            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ ëª©ë¡ì´ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤. -->
                                                                        </div>
                                                                            </nav>
                                                                    
                                                                            <!-- 2. ë©”ì¸ ì½˜í…ì¸  - ì¹´ë“œ ê·¸ë¦¬ë“œ -->        <main id="main-content">
            <!-- JavaScriptë¡œ ì¹´í…Œê³ ë¦¬ì™€ ì¹´ë“œê°€ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤. -->
        </main>

        <!-- [ì‹ ê·œ] Google Drive ì—°ë™ -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mt-8 mx-4 sm:mx-0">
            <h4 class="text-lg font-semibold mb-2 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-6 w-6 text-gray-500"><path d="M22 10v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-6l2.24-6.68a2 2 0 0 1 1.92-1.32h11.68a2 2 0 0 1 1.92 1.32L22 10z"></path><line x1="2" y1="10" x2="22" y2="10"></line><path d="m15.12 18-3.12-6-3.12 6"></path><path d="m8.28 12-3.12 6"></path><path d="m18.84 12-3.12 6"></path></svg>
                Google Drive ë™ê¸°í™”
            </h4>
            <div id="gdrive-auth-container" class="mb-4">
                <button id="gdrive-authorize-btn" class="w-full py-2 px-4 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 font-semibold rounded-lg transition-colors">Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸</button>
                <div id="gdrive-signout-container" class="flex items-center justify-between" style="display: none;">
                    <p id="gdrive-status" class="text-sm text-gray-600 dark:text-gray-400">ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</p>
                    <button id="gdrive-signout-btn" class="text-sm text-blue-500 hover:underline">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            <div id="gdrive-actions-container" class="grid grid-cols-2 gap-4" style="display: none;">
                <button id="import-gdrive-btn" class="w-full py-3 px-4 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-6l-4 4m0 0l-4-4m4 4V3"></path>
                    </svg>
                    Driveì—ì„œ ê°€ì ¸ì˜¤ê¸°
                </button>
                <button id="export-gdrive-btn" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v13"></path>
                    </svg>
                    Driveë¡œ ë‚´ë³´ë‚´ê¸°
                </button>
            </div>
            <p class="text-xs text-gray-500 mt-2">Google Drive ì—°ë™ ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ì§ì ‘ Google Cloudì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ì•„ì•¼ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.</p>
        </div>

        <!-- [ìˆ˜ì •] ì„¤ì • ëª¨ë“œ ë²„íŠ¼ ì˜ì—­ (Tailwind 'flex' í´ë˜ìŠ¤ ì œê±°) -->
        <div class="edit-controls mt-8 px-4 sm:px-0">
            <button id="add-category-btn" class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                + ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            </button>
            
            <!-- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] -->
            <div>
                <label for="font-selector" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ëŒ€ì‹œë³´ë“œ í°íŠ¸ ë³€ê²½</label>
                <select id="font-selector" class="font-selector focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="default">ê¸°ë³¸ í°íŠ¸ (Inter)</option>
                    <option value="Malgun Gothic">ë§‘ì€ ê³ ë”• (Malgun Gothic)</option>
                    <option value="Gulim">êµ´ë¦¼ (Gulim)</option>
                    <option value="Dotum">ë‹ì›€ (Dotum)</option>
                    <option value="Batang">ë°”íƒ• (Batang)</option>
                    <option value="Gungsuh">ê¶ì„œ (Gungsuh)</option>
                    <option value="Arial">Arial</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                    <!-- [ìˆ˜ì •] 'ì§ì ‘ ì…ë ¥...'ìœ¼ë¡œ ë³€ê²½ -->
                    <option value="custom">ì§ì ‘ ì…ë ¥...</option>
                </select>
                
                <!-- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ì‚¬ìš©ì ì •ì˜ í°íŠ¸ ì…ë ¥ ì˜ì—­ -->
                <div id="custom-font-container" class="mt-2 hidden"> <!-- [ìˆ˜ì •] space-y-3 ì œê±° -->
                    <!-- 1. ì‹œìŠ¤í…œ í°íŠ¸ ì´ë¦„ ì…ë ¥ (ì˜êµ¬ ì €ì¥) -->
                    <div>
                        <!-- [ìˆ˜ì •] ë¼ë²¨ í…ìŠ¤íŠ¸ ë³€ê²½ -->
                        <label for="custom-font-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì‚¬ìš©ì ì •ì˜ í°íŠ¸ ì´ë¦„</label>
                        <div class="flex gap-2">
                            <input type="text" id="custom-font-input" placeholder="ì˜ˆ: Noto Sans KR" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="apply-custom-font-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì ìš©</button>
                        </div>
                    </div>

                    <!-- [ìˆ˜ì •] í°íŠ¸ íŒŒì¼ ì„ íƒ ê¸°ëŠ¥ ì œê±° -->
                </div>
            </div>

            <!-- [ì¶”ê°€] ê°€ì ¸ì˜¤ê¸° / ë‚´ë³´ë‚´ê¸° -->
            <div class="grid grid-cols-2 gap-4">
                <button id="import-btn" class="w-full py-3 px-4 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-6l-4 4m0 0l-4-4m4 4V3" />
                    </svg>
                    ì„¤ì •/ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                </button>
                <button id="export-btn" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v13" />
                    </svg>
                    ì„¤ì •/ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                </button>
            </div>
            <!-- [ì¶”ê°€] ê°€ì ¸ì˜¤ê¸°ìš© ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
            <input type="file" id="import-file-input" class="hidden" accept="application/json">
        </div>
    </div>

    <!-- [ì‹ ê·œ] í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
    <!-- í™”ë©´ ìŠ¤í¬ë¡¤ ì‹œì—ë„ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ê³ ì •ë˜ì–´ ë³´ì…ë‹ˆë‹¤. -->
    <div id="floating-actions" class="fixed right-4 bottom-4 z-50 flex flex-col space-y-3">
        <!-- [ì‹ ê·œ] ë§¨ ìœ„ë¡œ ê°€ê¸° ë²„íŠ¼ -->
        <button id="scroll-to-top-btn" class="p-1.5 rounded-full bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-white shadow-xl transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M5 15l7-7 7 7" />
            </svg>
        </button>

        <!-- [ì‹ ê·œ] ë§¨ ì•„ë˜ë¡œ ê°€ê¸° ë²„íŠ¼ -->
        <button id="scroll-to-bottom-btn" class="p-1.5 rounded-full bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-white shadow-xl transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
            </svg>
        </button>

        <!-- [ì´ë™ëœ] ì„¤ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
        <button id="settings-toggle-btn" class="p-1.5 rounded-full bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white shadow-xl transition-colors">
            <svg id="settings-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.066z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <!-- [ì´ë™ëœ] ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
        <button id="theme-toggle" class="p-1.5 rounded-full bg-gray-700 dark:bg-gray-200 hover:bg-gray-800 dark:hover:bg-gray-300 text-white dark:text-gray-800 shadow-xl transition-colors">
            <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
            <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
        </button>
    </div>
    
    <!-- [ì¶”ê°€] ì‚¬ì´íŠ¸ ìˆ˜ì •/ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="site-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4 overflow-y-auto max-h-[90vh]">
            <h3 id="site-modal-title" class="text-xl font-semibold mb-4">ì‚¬ì´íŠ¸ í¸ì§‘</h3>
            <form id="site-form">
                <!-- í¼ í•„ë“œ (ì¹´í…Œê³ ë¦¬/ì‚¬ì´íŠ¸ ì¸ë±ìŠ¤ ì €ì¥ìš©) -->
                <input type="hidden" id="category-index">
                <input type="hidden" id="site-index">
                
                <div class="mb-4">
                    <label for="site-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë¦„</label>
                    <input type="text" id="site-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="site-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL</label>
                    <div class="flex items-center gap-2">
                        <input type="url" id="site-url" placeholder="https://..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        <button type="button" id="fetch-metadata-btn" class="p-2 bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300 rounded-md hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors" title="URL ì •ë³´ ê°€ì ¸ì˜¤ê¸°">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-1.026.977-2.19.977-3.431 0-5.225-4.253-9.475-9.475-9.475S1.025 5.775 1.025 11c0 1.241.332 2.405.977 3.431m16.036-1.452l-3.44-2.04m-3.44 2.04l3.44 2.04m0 0l-3.44-2.04m3.44 2.04l3.44 2.04M3.055 16.255l3.44-2.04m-3.44 2.04l-3.44-2.04m3.44 2.04l3.44 2.04" />
                            </svg>
                        </button>
                        <!-- Spinner (hidden by default) -->
                        <svg id="fetch-spinner" class="animate-spin h-5 w-5 text-blue-500 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="site-icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì•„ì´ì½˜ (ì´ëª¨ì§€ ë˜ëŠ” URL)</label>
                    <input type="text" id="site-icon" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- [ì¶”ê°€] íŒŒì¼ ì—…ë¡œë“œ í•„ë“œ -->
                <div class="mb-4">
                    <label for="site-icon-file" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ (1MB ì´í•˜)</label>
                    <input type="file" id="site-icon-file" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-blue-50 dark:file:bg-blue-900
                        file:text-blue-700 dark:file:text-blue-300
                        hover:file:bg-blue-100 dark:hover:file:bg-blue-800
                    ">
                    <!-- [ì¶”ê°€] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                    <img id="site-icon-preview" src="" alt="ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°" class="w-16 h-16 rounded-lg object-cover mt-3 hidden">
                </div>

                <div class="mb-4">
                    <label for="site-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì„¤ëª…</label>
                    <input type="text" id="site-description" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-site-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì¶”ê°€] ì¹´í…Œê³ ë¦¬ ìˆ˜ì •/ì¶”ê°€ ëª¨ë‹¬ ... -->
    <div id="category-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <h3 id="category-modal-title" class="text-xl font-semibold mb-4">ì¹´í…Œê³ ë¦¬ í¸ì§‘</h3>
            <form id="category-form">
                <input type="hidden" id="edit-category-index">
                
                <div class="mb-4">
                    <label for="category-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì¹´í…Œê³ ë¦¬ ì´ë¦„</label>
                    <input type="text" id="category-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <!-- [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ íƒ€ì… ì„ íƒ -->
                <div class="mb-4">
                    <label for="category-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì¹´í…Œê³ ë¦¬ íƒ€ì…</label>
                    <select id="category-type" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="links">ë§í¬</option>
                        <option value="events">ì´ë²¤íŠ¸ (D-day/ì•Œë¦¼)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="category-color" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì¹´í…Œê³ ë¦¬ ìƒ‰ìƒ</label>
                    <input type="color" id="category-color" class="w-full h-10 p-1 border border-gray-300 dark:border-gray-600 rounded-md" value="#3B82F6">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-category-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª© ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="title-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <h3 id="title-modal-title" class="text-xl font-semibold mb-4">ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì •</h3>
            <form id="title-form">
                <div class="mb-4">
                    <label for="dashboard-title-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ëŒ€ì‹œë³´ë“œ ì´ë¦„</label>
                    <input type="text" id="dashboard-title-input" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-title-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì‹ ê·œ] ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirm-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <h3 class="text-xl font-semibold mb-4 text-red-600 dark:text-red-400">ì‚­ì œ í™•ì¸</h3>
            <p id="confirm-modal-message" class="text-gray-700 dark:text-gray-300 mb-6">ì´ í•­ëª©ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="flex justify-end gap-3">
                <button type="button" id="cancel-confirm-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                <button type="button" id="confirm-delete-btn" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md shadow-md transition-colors">ì‚­ì œ</button>
            			</div>
                    </div>
                </div>
            
                <!-- [ì‹ ê·œ] ì´ë²¤íŠ¸ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
                <div id="event-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
                    <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4 overflow-y-auto max-h-[90vh]">
                        <h3 id="event-modal-title" class="text-xl font-semibold mb-4">ì´ë²¤íŠ¸ í¸ì§‘</h3>
                        <form id="event-form">
                            <input type="hidden" id="event-category-index">
                            <input type="hidden" id="event-index">
                            
                            <div class="mb-4">
                                <label for="event-type" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">íƒ€ì…</label>
                                <select id="event-type" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="dday">D-Day</option>
                                    <option value="alarm">ì•Œë¦¼ (Notification)</option>
                                </select>
                            </div>
            
                            <div class="mb-4">
                                <label for="event-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë¦„ (ì œëª©)</label>
                                <input type="text" id="event-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
            
                                                            <div class="mb-4">
            
                                                                <label for="event-icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì•„ì´ì½˜ (ì´ëª¨ì§€)</label>
            
                                                                <input type="text" id="event-icon" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
            
                                                                <!-- [ì‹ ê·œ] ì´ëª¨ì§€ ì„ íƒ ë²„íŠ¼ -->
            
                                                                                    <div id="emoji-selector" class="mt-2 grid grid-cols-5 gap-2">
            
                                                                                        <button type="button" title="ê¸°ë…ì¼/ìƒì¼" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ‚</button>
            
                                                                                        <button type="button" title="ëª©í‘œ" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ¯</button>
            
                                                                                        <button type="button" title="ì—…ë¬´" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ’¼</button>
            
                                                                                        <button type="button" title="ì‹œí—˜/ê³µë¶€" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ“</button>
            
                                                                                        <button type="button" title="ì¤‘ìš”" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ“Œ</button>
            
                                                                                        <button type="button" title="ì•Œë¦¼" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ””</button>
            
                                                                                        <button type="button" title="ì¼ì •" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ“…</button>
            
                                                                                        <button type="button" title="í”„ë¡œì íŠ¸/ì‹œì‘" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸš€</button>
            
                                                                                        <button type="button" title="ì•„ì´ë””ì–´" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ’¡</button>
            
                                                                                        <button type="button" title="ì¶•í•˜" class="p-2 text-lg leading-none rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600">ğŸ‰</button>
            
                                                                                    </div>
            
                                                            </div>            
                            <div id="dday-fields" class="mb-4">
                                <label for="event-date" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">D-Day ë‚ ì§œ</label>
                                <input type="date" id="event-date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
            
                                            <div id="alarm-fields" class="mb-4 hidden space-y-4">
                                                <div>
                                                    <label for="event-datetime" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì•Œë¦¼ ë‚ ì§œ ë° ì‹œê°„</label>
                                                    <input type="datetime-local" id="event-datetime" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                </div>
                                                <div>
                                                    <label for="event-recurrence" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë°˜ë³µ</label>
                                                                            <select id="event-recurrence" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                                                <option value="none">ë°˜ë³µ ì•ˆ í•¨</option>
                                                                                <option value="daily">ë§¤ì¼</option>
                                                                                <option value="weekly">ë§¤ì£¼</option>
                                                                                <option value="monthly">ë§¤ì›”</option>
                                                                                <option value="yearly">ë§¤ë…„</option>
                                                                            </select>                                                </div>
                                            </div>            
                            <div class="flex justify-end gap-3 mt-6">
                                <button type="button" id="cancel-event-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                                <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                            </div>
                        </form>
                    </div>
                </div>
            
                <!-- [ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ (í”¼ë“œë°±) -->
                <div id="toast" class="toast fixed bottom-10 right-10 bg-green-600 text-white px-5 py-3 rounded-lg shadow-xl z-[999]">        ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>


    <!-- 3. JavaScript ì˜ì—­ -->
    <script>
        // --- [ì¶”ê°€] 3.1. í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ê¸°ëŠ¥ ---
        let currentZoom = 1.0;
        const ZOOM_STEP = 0.1; // 10%ì”© ì¡°ì ˆ
        const MIN_ZOOM = 0.5;  // ìµœì†Œ 50%
        const MAX_ZOOM = 2.0;  // ìµœëŒ€ 200%

        /**
         * ì§€ì •ëœ ë ˆë²¨ë¡œ í™”ë©´ í™•ëŒ€/ì¶•ì†Œë¥¼ ì ìš©í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
         * @param {number} level - ì ìš©í•  í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨ (ì˜ˆ: 1.0)
         */
        function applyZoom(level) {
            // ë²”ìœ„ ì œí•œ
            currentZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, level));
            // ì†Œìˆ˜ì  2ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼ (ë¶€ë™ ì†Œìˆ˜ì  ì˜¤ë¥˜ ë°©ì§€)
            currentZoom = Math.round(currentZoom * 100) / 100;
            
            // bodyì˜ zoom ì†ì„± ë³€ê²½
            document.body.style.zoom = currentZoom;
            // localStorageì— ì €ì¥
            localStorage.setItem('dashboardZoomLevel', currentZoom);
            
            // ë¦¬ì…‹ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const zoomResetBtn = document.getElementById('zoom-reset-btn');
            if (zoomResetBtn) {
                zoomResetBtn.textContent = `${Math.round(currentZoom * 100)}%`;
                // 100%ì¼ ë•Œ ê°•ì¡°
                if (currentZoom === 1.0) {
                    zoomResetBtn.classList.add('text-blue-600', 'dark:text-blue-400');
                } else {
                    zoomResetBtn.classList.remove('text-blue-600', 'dark:text-blue-400');
                }
            }
        }

        /** í™”ë©´ í™•ëŒ€ */
        function zoomIn() {
            applyZoom(currentZoom + ZOOM_STEP);
        }

        /** í™”ë©´ ì¶•ì†Œ */
        function zoomOut() {
            applyZoom(currentZoom - ZOOM_STEP);
        }

        /** í™•ëŒ€/ì¶•ì†Œ ì´ˆê¸°í™” */
        function resetZoom() {
            applyZoom(1.0);
        }

        /** í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨ ì ìš© */
        function loadZoom() {
            const savedZoom = localStorage.getItem('dashboardZoomLevel');
            applyZoom(parseFloat(savedZoom) || 1.0);
        }

        // --- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ---

        /**
         * ì§€ì •ëœ í°íŠ¸ë¥¼ bodyì— ì ìš©í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
         * @param {string} fontName - ì ìš©í•  í°íŠ¸ ì´ë¦„
         */
        function applyFont(fontName) {
            // [ìˆ˜ì •] fontNameì´ nullì´ê±°ë‚˜ undefinedì¼ ê²½ìš° 'default'ë¡œ ì²˜ë¦¬
            fontName = fontName || 'default'; 
            
            localStorage.setItem('dashboardFont', fontName);
            
            const customContainer = document.getElementById('custom-font-container');

            if (fontName === 'default') {
                document.body.style.fontFamily = "'Inter', sans-serif";
                if (customContainer) customContainer.classList.add('hidden');
            } else if (fontName === 'custom') {
                // 'ì‚¬ìš©ì ì •ì˜...'ë¥¼ ì„ íƒí•œ ê²½ìš°, ì…ë ¥ í•„ë“œë§Œ ë³´ì—¬ì£¼ê³  í°íŠ¸ëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŒ
                if (customContainer) customContainer.classList.remove('hidden');
            } else {
                // 'Malgun Gothic' ë˜ëŠ” ì‚¬ìš©ì ì…ë ¥ í°íŠ¸
                document.body.style.fontFamily = `'${fontName}', 'Inter', sans-serif`;
                
                // [ìˆ˜ì •] í‘œì¤€ í°íŠ¸ê°€ ì„ íƒë˜ë©´ ì‚¬ìš©ì ì…ë ¥ í•„ë“œë¥¼ ìˆ¨ê¹€
                const fontSelector = document.getElementById('font-selector');
                const standardFonts = Array.from(fontSelector.options).map(opt => opt.value);
                if (standardFonts.includes(fontName) && fontName !== 'custom') {
                     if (customContainer) customContainer.classList.add('hidden');
                }
            }
        }

        /** í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í°íŠ¸ ì ìš© */
        function loadFont() {
            const savedFont = localStorage.getItem('dashboardFont') || 'default';
            const fontSelector = document.getElementById('font-selector');
            
            // 1. í°íŠ¸ ìŠ¤íƒ€ì¼ ì ìš© (ì˜êµ¬ ì €ì¥ëœ í°íŠ¸ë§Œ)
            applyFont(savedFont);

            // 2. UI(ë“œë¡­ë‹¤ìš´, ì…ë ¥ í•„ë“œ) ìƒíƒœ ë³µì›
            const standardFonts = Array.from(fontSelector.options).map(opt => opt.value);

            if (standardFonts.includes(savedFont)) {
                // ì €ì¥ëœ í°íŠ¸ê°€ í‘œì¤€ ëª©ë¡ì— ìˆìœ¼ë©´, ë“œë¡­ë‹¤ìš´ ê°’ì„ ì„¤ì •
                fontSelector.value = savedFont;
                document.getElementById('custom-font-container').classList.add('hidden');
            } else {
                // í‘œì¤€ ëª©ë¡ì— ì—†ìœ¼ë©´(ì‚¬ìš©ì ì •ì˜ í°íŠ¸ì´ë©´)
                fontSelector.value = 'custom';
                document.getElementById('custom-font-container').classList.remove('hidden');
                document.getElementById('custom-font-input').value = savedFont;
            }
        }

        // --- 3.2 -> 3.3. ì „ì—­ ë³€ìˆ˜ ë° DOM ìš”ì†Œ ì„ íƒ ---
        let siteData = []; // ë°ì´í„°ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
        let dashboardTitle = "My Dashboard"; // [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª©
        let editMode = false; // ì„¤ì • ëª¨ë“œ ìƒíƒœ
        
        // [ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì¸ìŠ¤í„´ìŠ¤
        let categorySortable = null;
        let siteSortables = [];

        const mainContent = document.getElementById('main-content');
        const currentTimeEl = document.getElementById('currentTime');
        // [ìˆ˜ì •] í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ì°¸ì¡°ëŠ” í”Œë¡œíŒ… ì˜ì—­ì˜ ë²„íŠ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const themeToggleBtn = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');
        // [ì¶”ê°€] ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜
        const categoryNav = document.getElementById('category-nav'); 

        // [ìˆ˜ì •] ì„¤ì • ëª¨ë“œ ìš”ì†Œ ì°¸ì¡°ëŠ” í”Œë¡œíŒ… ì˜ì—­ì˜ ë²„íŠ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const settingsToggleBtn = document.getElementById('settings-toggle-btn');
        const settingsIcon = document.getElementById('settings-icon');
        const closeIcon = document.getElementById('close-icon');
        const addCategoryBtn = document.getElementById('add-category-btn');
        const dashboardTitleEl = document.getElementById('dashboard-title'); // [ì¶”ê°€]

        // [ì¶”ê°€] ëª¨ë‹¬ ìš”ì†Œ
        const siteModal = document.getElementById('site-modal');
        const siteForm = document.getElementById('site-form');
        const categoryModal = document.getElementById('category-modal');
        const categoryForm = document.getElementById('category-form');
        const titleModal = document.getElementById('title-modal'); // [ì¶”ê°€]
        const titleForm = document.getElementById('title-form'); // [ì¶”ê°€]
        const eventModal = document.getElementById('event-modal'); // [ì‹ ê·œ]
        const toastEl = document.getElementById('toast');

        // [ì¶”ê°€] ê²€ìƒ‰ í¼ ìš”ì†Œ
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const searchEngineRadios = document.querySelectorAll('input[name="search-engine"]');


        // --- [ìˆ˜ì •] 3.3 -> 3.4. ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ (localStorage) ---
        // [ìˆ˜ì •] ë°ì´í„° ë¡œë“œ ë¡œì§ (ê°ì²´ êµ¬ì¡°ë¡œ ë³€ê²½ ë° ë§ˆì´ê·¸ë ˆì´ì…˜)
        function loadData() {
            let dataString = localStorage.getItem('myDashboardData');
            let needsMigration = false;

            if (!dataString) {
                // 1. ì‹ ê·œ ì‚¬ìš©ì: ê¸°ë³¸ê°’ ì„¤ì •
                siteData = [
                    {
                        category: "ì£¼ìš” í¬í„¸",
                        type: "links", // [ì‹ ê·œ] íƒ€ì… ì¶”ê°€
                        sites: [
                            { name: "Naver", url: "https://www.naver.com", icon: "ğŸŸ¢", description: "êµ­ë‚´ 1ìœ„ í¬í„¸ ì‚¬ì´íŠ¸", clicks: 0 },
                            { name: "Google", url: "https://www.google.com", icon: "ğŸ”µ", description: "ê¸€ë¡œë²Œ ê²€ìƒ‰ ì—”ì§„", clicks: 0 },
                        ]
                    },
                    {
                        category: "ê°œë°œ ë„êµ¬",
                        type: "links", // [ì‹ ê·œ] íƒ€ì… ì¶”ê°€
                        sites: [
                            { name: "GitHub", url: "https://github.com", icon: "ğŸ™", description: "ì½”ë“œ í˜¸ìŠ¤íŒ… í”Œë«í¼", clicks: 0 },
                            { name: "Stack Overflow", url: "https://stackoverflow.com", icon: "ğŸ“š", description: "ê°œë°œì Q&A ì»¤ë®¤ë‹ˆí‹°", clicks: 0 },
                        ]
                    }
                ];
                dashboardTitle = "My Dashboard";
                needsMigration = true; // ê¸°ë³¸ ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
            } else {
                let data = JSON.parse(dataString);
                
                if (Array.isArray(data)) {
                    // 2. ê¸°ì¡´ ì‚¬ìš©ì (êµ¬ì¡° ë§ˆì´ê·¸ë ˆì´ì…˜): ë°°ì—´ -> ê°ì²´
                    siteData = data;
                    dashboardTitle = "My Dashboard"; // ê¸°ë³¸ ì œëª© ì¶”ê°€
                    needsMigration = true; // ìƒˆ êµ¬ì¡°ë¡œ ì €ì¥
                } else if (typeof data === 'object' && data !== null && data.categories) {
                    // 3. ì •ìƒ ì‚¬ìš©ì (ìƒˆ êµ¬ì¡°)
                    siteData = data.categories;
                    dashboardTitle = data.title || "My Dashboard";
                } else {
                    // 4. ë°ì´í„° ì†ìƒ: ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                    siteData = [];
                    dashboardTitle = "My Dashboard";
                    needsMigration = true;
                }
            }

            // [ë²„ê·¸ ìˆ˜ì •] ì €ì¥ëœ ë°ì´í„°ì— null ë˜ëŠ” undefined í•­ëª©ì´ ìˆì„ ê²½ìš° ì œê±°
            const originalLength = siteData.length;
            siteData = siteData.filter(category => category); // null, undefined ë“± falsy ê°’ ì œê±°
            if (siteData.length < originalLength) {
                needsMigration = true; // ë°ì´í„°ê°€ ì •ë¦¬ë˜ì—ˆìœ¼ë¯€ë¡œ ë‹¤ì‹œ ì €ì¥í•´ì•¼ í•¨
            }
            
            // [ì‹ ê·œ] ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜: ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— 'type' ì†ì„± ë¶€ì—¬
            siteData.forEach(category => {
                if (!category.type) {
                    category.type = 'links'; // ê¸°ì¡´ ë°ì´í„°ëŠ” 'links' íƒ€ì…ìœ¼ë¡œ ì§€ì •
                    needsMigration = true;
                }
                
                // [ì‹ ê·œ] ëª¨ë“  ì‚¬ì´íŠ¸ ê°ì²´ì— 'clicks' ì†ì„±ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™”
                // 'links' íƒ€ì… ì¹´í…Œê³ ë¦¬ì—ë§Œ 'clicks' ì†ì„± ì´ˆê¸°í™” ì ìš©
                if (category.type === 'links' && category.sites) {
                    category.sites.forEach(site => {
                        if (typeof site.clicks === 'undefined') {
                            site.clicks = 0;
                        }
                    });
                } else if (category.type === 'events' && !category.sites) {
                     // [ì‹ ê·œ] 'events' íƒ€ì…ì¸ë° sites ë°°ì—´ì´ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
                    category.sites = [];
                    needsMigration = true;
                }
            });
            
            if (needsMigration) {
                // ë§ˆì´ê·¸ë ˆì´ì…˜ ë˜ëŠ” ì´ˆê¸° ì €ì¥ì„ ìˆ˜í–‰ (saveData()ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ)
                const dataToSave = { title: dashboardTitle, categories: siteData };
                localStorage.setItem('myDashboardData', JSON.stringify(dataToSave));
            }

            dashboardTitleEl.textContent = dashboardTitle; // UIì— ì œëª© ë°˜ì˜
        }

        // [ìˆ˜ì •] ì €ì¥ ë¡œì§ (ê°ì²´ êµ¬ì¡°ë¡œ ì €ì¥, ë Œë”ë§ ì œì–´, ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›)
        function saveData(shouldRender = true, options = {}) {
            const dataToSave = { title: dashboardTitle, categories: siteData };
            localStorage.setItem('myDashboardData', JSON.stringify(dataToSave));
            
            // UI ì—…ë°ì´íŠ¸
            dashboardTitleEl.textContent = dashboardTitle;
            if (shouldRender) {
                renderCards();
                renderSummaryBoxes(); // [ì‹ ê·œ] ìš”ì•½ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
                if (options.scrollY) {
                    // ë Œë”ë§ í›„, ì €ì¥ëœ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¡œ ë³µì›
                    window.scrollTo(0, options.scrollY);
                }
            }

            if (options.showToast !== false) {
                showToast("ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }


        /**
         * íŒŒì¼ ì´ë¦„ì— ì‚¬ìš©í•  í˜„ì¬ ì‹œê° ë¬¸ìì—´ (YYYY-MM-DD_HHMMSS)ì„ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function getExportDateTimeString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            return `${year}-${month}-${day}_${hours}${minutes}${seconds}`;
        }


        // --- [ì¶”ê°€] 3.4 -> 3.5. ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ---
        function exportData() {
            try {
                const dataToExport = {
                    dashboardData: JSON.parse(localStorage.getItem('myDashboardData') || '{}'),
                    theme: localStorage.getItem('theme') || 'light',
                    searchEngine: localStorage.getItem('searchEngine') || 'google',
                    zoomLevel: localStorage.getItem('dashboardZoomLevel') || '1.0',
                    font: localStorage.getItem('dashboardFont') || 'default'
                };
                
                // JSON ë¬¸ìì—´ë¡œ ë³€í™˜ (ì˜ˆì˜ê²Œ í¬ë§·íŒ…)
                const jsonString = JSON.stringify(dataToExport, null, 2);
                // Blob ê°ì²´ ìƒì„±
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                const defaultName = `my-dashboard-backup-${getExportDateTimeString()}.json`;

                // [ìˆ˜ì •] "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" ê¸°ëŠ¥ êµ¬í˜„ (í´ë” ì„ íƒ ê¸°ëŠ¥)
                if ('showSaveFilePicker' in window) {
                    // 1. ìµœì‹  ë¸Œë¼ìš°ì €: "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" ëŒ€í™”ìƒì ì‚¬ìš©
                    window.showSaveFilePicker({
                        suggestedName: defaultName,
                        types: [{
                            description: 'JSON Files',
                            accept: { 'application/json': ['.json'] },
                        }],
                    }).then(async (handle) => {
                        // íŒŒì¼ì— ë°ì´í„° ì“°ê¸°
                        const writable = await handle.createWritable();
                        await writable.write(blob);
                        await writable.close();
                        showToast("íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    }).catch(error => {
                        // ì‚¬ìš©ìê°€ "ì·¨ì†Œ"ë¥¼ ëˆ„ë¥¸ ê²½ìš°
                        if (error.name === 'AbortError') {
                            console.log('File save cancelled by user.');
                            showToast("íŒŒì¼ ì €ì¥ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.", false, 1500);
                        } else {
                            // ê¸°íƒ€ ì˜¤ë¥˜
                            console.error("Export failed:", error);
                            showToast("ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (Error: " + error.message + ")", true);
                        }
                    });

                } else {
                    // 2. êµ¬í˜• ë¸Œë¼ìš°ì €: ê¸°ì¡´ì˜ ìë™ ë‹¤ìš´ë¡œë“œ ë°©ì‹ ì‚¬ìš© (í´ë°±)
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = defaultName; // [ìˆ˜ì •] ì‹œê°„ í¬í•¨ íŒŒì¼ëª… ì ìš©
                    document.body.appendChild(a);
                    a.click();

                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showToast("ì„¤ì •ì´ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤. (ìë™ ë‹¤ìš´ë¡œë“œ)");
                }

            } catch (error) {
                console.error("Export failed:", error);
                showToast("ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
            }
        }


        function importData(e) {
            const file = e.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // íŒŒì¼ êµ¬ì¡°ê°€ ì˜¬ë°”ë¥¸ì§€ ìµœì†Œí•œìœ¼ë¡œ ê²€ì¦
                    if (importedData && importedData.dashboardData && importedData.theme && importedData.searchEngine) {
                        
                        // ê²€ì¦ í†µê³¼ ì‹œ, ëª¨ë“  ì„¤ì •ì„ localStorageì— ë®ì–´ì”ë‹ˆë‹¤.
                        localStorage.setItem('myDashboardData', JSON.stringify(importedData.dashboardData));
                        localStorage.setItem('theme', importedData.theme);
                        localStorage.setItem('searchEngine', importedData.searchEngine);
                        // [ìˆ˜ì •] í°íŠ¸ ì„¤ì •ë„ í•¨ê»˜ ê°€ì ¸ì˜µë‹ˆë‹¤.
                        localStorage.setItem('dashboardZoomLevel', importedData.zoomLevel || '1.0');
                        localStorage.setItem('dashboardFont', importedData.font || 'default');

                        showToast("ì„¤ì •ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
                        
                        // 1.5ì´ˆ í›„ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ëª¨ë“  ë³€ê²½ì‚¬í•­(í…Œë§ˆ, ê²€ìƒ‰ì—”ì§„, ë°ì´í„°, í™•ëŒ€/ì¶•ì†Œ, í°íŠ¸)ì„ ì ìš©
                        setTimeout(() => {
                            location.reload();
                        }, 1500);

                    } else {
                        showToast("ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.", true);
                    }
                } catch (error) {
                    console.error("Import failed:", error);
                    showToast("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
                } finally {
                    // ë‹¤ìŒì—ë„ ë™ì¼í•œ íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì…ë ¥ê°’ ì´ˆê¸°í™”
                    e.target.value = null;
                }
            };
            
            reader.onerror = function() {
                showToast("íŒŒì¼ì„ ì½ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
                e.target.value = null;
            };

            reader.readAsText(file);
        }

        // --- [ìˆ˜ì •] 3.5 -> 3.6. UI í”¼ë“œë°± í•¨ìˆ˜ ---
        function showToast(message, isError = false) {
            toastEl.textContent = message;
            
            if (isError) {
                toastEl.classList.add('error');
                toastEl.classList.remove('bg-green-600');
            } else {
                toastEl.classList.remove('error');
                toastEl.classList.add('bg-green-600');
            }

            toastEl.classList.add('show');
            setTimeout(() => {
                toastEl.classList.remove('show');
                // ìŠ¤íƒ€ì¼ ì›ë³µ
                if (isError) {
                    toastEl.classList.remove('error');
                }
            }, 2500); // 2.5ì´ˆ í›„ ì‚¬ë¼ì§
        }
        
        // --- [ì‹ ê·œ] 3.7. ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ ë Œë”ë§ ---
        function renderCategoryNav() {
            categoryNav.innerHTML = '';
            
            if (siteData.length === 0) {
                // ì¹´í…Œê³ ë¦¬ê°€ ì—†ìœ¼ë©´ ë‚´ë¹„ê²Œì´ì…˜ ìˆ¨ê¸°ê¸°
                document.getElementById('category-nav-wrapper').style.display = 'none';
                return;
            }
            document.getElementById('category-nav-wrapper').style.display = 'flex'; // ë‹¤ì‹œ ë³´ì´ê²Œ
            
            siteData.forEach((category, index) => {
                const categoryId = `category-${index}`;
                const navItem = document.createElement('a');
                
                navItem.href = `#${categoryId}`;
                navItem.textContent = category.category;
                navItem.dataset.categoryId = categoryId;
                navItem.className = 'category-nav-item text-base font-medium hover:no-underline'; // [ìˆ˜ì •] íƒ­ ìŠ¤íƒ€ì¼ í´ë˜ìŠ¤ ì ìš©

                // í´ë¦­ ì´ë²¤íŠ¸ëŠ” setupEventListenersì—ì„œ ìœ„ì„ ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
                
                categoryNav.appendChild(navItem);
            });
            
            // [ì¶”ê°€] ë Œë”ë§ í›„, ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ í™œì„±í™”ëœ íƒ­ì„ ì´ˆê¸° ì„¤ì •
            updateActiveCategoryNav();
        }
        
        // --- [ì‹ ê·œ] 3.8. í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê¸°ë°˜ í™œì„±í™”ëœ ì¹´í…Œê³ ë¦¬ ì—…ë°ì´íŠ¸ ---
        function updateActiveCategoryNav() {
            let activeId = '';
            const sections = mainContent.querySelectorAll('section[id^="category-"]');
            /* [ìˆ˜ì •] ê³ ì • í—¤ë”ê°€ ì—†ìœ¼ë¯€ë¡œ offsetì„ ì‘ê²Œ ì¡°ì • */
            const scrollPos = window.scrollY + 20; 

            // í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ ìœ„ì— ìˆëŠ” ì„¹ì…˜ì„ ì°¾ìŠµë‹ˆë‹¤.
            for (let i = sections.length - 1; i >= 0; i--) {
                const section = sections[i];
                if (section.offsetTop <= scrollPos) {
                    activeId = section.id;
                    break;
                }
            }

            // ëª¨ë“  íƒ­ì˜ active í´ë˜ìŠ¤ë¥¼ ì œê±°í•˜ê³ , í˜„ì¬ í™œì„±í™”ëœ íƒ­ì—ë§Œ ì¶”ê°€í•©ë‹ˆë‹¤.
            document.querySelectorAll('.category-nav-item').forEach(item => {
                if (item.dataset.categoryId === activeId) {
                    item.classList.add('active');
                    /* [ì œê±°] ë‚´ë¹„ê²Œì´ì…˜ ë°”ê°€ ê³ ì •ë˜ì–´ ìˆì§€ ì•Šìœ¼ë¯€ë¡œ íƒ­ì„ ìŠ¤í¬ë¡¤í•˜ëŠ” ë¡œì§ ì œê±°
                    // í™œì„±í™”ëœ íƒ­ì´ ì¤‘ì•™ì— ì˜¤ë„ë¡ ìŠ¤í¬ë¡¤í•©ë‹ˆë‹¤.
                    const navRect = categoryNav.getBoundingClientRect();
                    // ... (ê´€ë ¨ ë¡œì§ ëª¨ë‘ ì œê±°) ...
                    categoryNav.scrollTo({
                        left: scrollLeft,
                        behavior: 'smooth'
                    });
                    */
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // --- [ì‹ ê·œ] ëª¨ë“  í´ë¦­ ìˆ˜ ì´ˆê¸°í™” í•¨ìˆ˜ ---
        function clearAllClickCounts() {
            siteData.forEach(category => {
                // [ìˆ˜ì •] links íƒ€ì… ì¹´í…Œê³ ë¦¬ì˜ ì‚¬ì´íŠ¸ë§Œ ì´ˆê¸°í™”
                if (category.type === 'links' && category.sites) {
                    category.sites.forEach(site => {
                        site.clicks = 0;
                    });
                }
            });
            saveData(true); // ë³€ê²½ì‚¬í•­ ì €ì¥ ë° í™”ë©´ ë‹¤ì‹œ ë Œë”ë§
        }

        // --- [ì‹ ê·œ] 3.17. ì¸ê¸° ì‚¬ì´íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ---
        function getPopularSites(limit = 5) {
            const allSites = [];
            siteData.forEach((category, categoryIndex) => {
                 // [ìˆ˜ì •] links íƒ€ì… ì¹´í…Œê³ ë¦¬ì˜ ì‚¬ì´íŠ¸ë§Œ ì§‘ê³„
                if (category.type === 'links' && category.sites) {
                    category.sites.forEach((site, siteIndex) => {
                        // ì›ë³¸ ì¹´í…Œê³ ë¦¬ ë° ì‚¬ì´íŠ¸ ì¸ë±ìŠ¤ë¥¼ í¬í•¨í•œ ì‚¬ì´íŠ¸ ê°ì²´ ë³µì‚¬ë³¸ ìƒì„±
                        allSites.push({ 
                            ...site, 
                            originalCategoryIndex: categoryIndex, 
                            originalSiteIndex: siteIndex 
                        });
                    });
                }
            });

            // í´ë¦­ ìˆ˜ê°€ 0ë³´ë‹¤ í° ì‚¬ì´íŠ¸ë§Œ í•„í„°ë§í•˜ê³ , í´ë¦­ ìˆ˜ì— ë”°ë¼ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ í›„ ìƒìœ„ Nê°œ ë°˜í™˜
            const popularSites = allSites
                .filter(site => site.clicks > 0)
                .sort((a, b) => b.clicks - a.clicks)
                .slice(0, limit);

            return popularSites;
        }

        /** [ì‹ ê·œ] í—¤ë” ìš”ì•½ ë°•ìŠ¤ ë Œë”ë§ í•¨ìˆ˜ */
        function renderSummaryBoxes() {
            const ddayBox = document.getElementById('dday-summary-box');
            const alarmBox = document.getElementById('alarm-summary-box');

            let allEvents = [];
            siteData.forEach(cat => {
                if (cat.type === 'events' && cat.sites) { // [ìˆ˜ì •] cat.sitesê°€ ìˆëŠ”ì§€ í™•ì¸
                    allEvents.push(...cat.sites);
                }
            });

            const now = new Date();
            const todayMidnight = new Date(new Date().setHours(0, 0, 0, 0));
            const threeDaysFromNow = new Date(now.getTime() + 3 * 24 * 60 * 60 * 1000);

            // 1. D-Day ì²˜ë¦¬
            const ddays = allEvents
                .filter(e => e.type === 'dday' && e.targetDate)
                .map(e => {
                    const targetDate = new Date(new Date(e.targetDate).setHours(0, 0, 0, 0));
                    const diffTime = targetDate.getTime() - todayMidnight.getTime();
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    return { ...e, diffDays };
                })
                .sort((a, b) => a.diffDays - b.diffDays);

            if (ddays.length > 0) {
                ddayBox.innerHTML = ddays.map(dday => {
                    let ddayText = `D-${dday.diffDays}`;
                    if (dday.diffDays === 0) ddayText = 'D-Day';
                    else if (dday.diffDays < 0) ddayText = `D+${Math.abs(dday.diffDays)}`;
                    return `<div class="flex justify-between items-center"><span>${dday.icon || 'ğŸ“…'} ${dday.name}</span><span class="font-semibold text-red-500">${ddayText}</span></div>`;
                }).join('');
            } else {
                ddayBox.innerHTML = '<p class="text-gray-500">í‘œì‹œí•  D-Dayê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            // 2. ì•Œë¦¼ ì²˜ë¦¬ (ë°˜ë³µ ê¸°ëŠ¥ ìˆ˜ì •)
            const upcomingAlarms = allEvents
                .filter(e => e.type === 'alarm' && e.targetDate)
                .flatMap(event => { // map -> flatMapìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ ë°œìƒ ì‹œê°„ì„ ë°˜í™˜í•˜ë„ë¡ í•¨
                    const occurrences = [];
                    const startDate = new Date(event.targetDate);
                    
                    // [ë²„ê·¸ ìˆ˜ì •] ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œ(Invalid Date)ì¼ ê²½ìš° ê±´ë„ˆë›°ê¸°
                    if (isNaN(startDate.getTime())) {
                        console.warn("Invalid event date found:", event);
                        return [];
                    }

                    const targetHours = startDate.getHours();
                    const targetMinutes = startDate.getMinutes();

                    if (event.recurrence === 'daily') {
                        for (let i = 0; i < 4; i++) { // ì˜¤ëŠ˜ë¶€í„° 3ì¼ í›„ê¹Œì§€, ì´ 4ì¼ê°„ í™•ì¸
                            let potentialDate = new Date(now);
                            potentialDate.setDate(now.getDate() + i);
                            potentialDate.setHours(targetHours, targetMinutes, 0, 0);

                            if (potentialDate.getTime() >= now.getTime() && potentialDate.getTime() <= threeDaysFromNow.getTime()) {
                                occurrences.push({ ...event, occurrence: potentialDate });
                            }
                        }
                    } else {
                        let nextOccurrence = null;
                        switch (event.recurrence) {
                            case 'weekly':
                                let weeklyNext = new Date(now);
                                weeklyNext.setHours(targetHours, targetMinutes, 0, 0);
                                weeklyNext.setDate(now.getDate() + (startDate.getDay() - now.getDay() + 7) % 7);
                                if (weeklyNext.getTime() < now.getTime()) {
                                    weeklyNext.setDate(weeklyNext.getDate() + 7);
                                }
                                nextOccurrence = weeklyNext;
                                break;
                            case 'monthly':
                                let monthlyNext = new Date(now);
                                monthlyNext.setHours(targetHours, targetMinutes, 0, 0);
                                monthlyNext.setDate(startDate.getDate());
                                if (monthlyNext.getTime() < now.getTime()) {
                                    monthlyNext.setMonth(monthlyNext.getMonth() + 1);
                                }
                                if (monthlyNext.getDate() !== startDate.getDate()) {
                                    monthlyNext.setDate(0);
                                }
                                nextOccurrence = monthlyNext;
                                break;
                            case 'yearly':
                                let yearlyNext = new Date(now);
                                yearlyNext.setHours(targetHours, targetMinutes, 0, 0);
                                yearlyNext.setMonth(startDate.getMonth());
                                yearlyNext.setDate(startDate.getDate());
                                if (yearlyNext.getTime() < now.getTime()) {
                                    yearlyNext.setFullYear(yearlyNext.getFullYear() + 1);
                                }
                                nextOccurrence = yearlyNext;
                                break;
                            default: // 'none'
                                nextOccurrence = startDate;
                                break;
                        }
                        if (nextOccurrence && nextOccurrence.getTime() >= now.getTime() && nextOccurrence.getTime() <= threeDaysFromNow.getTime()) {
                            occurrences.push({ ...event, occurrence: nextOccurrence });
                        }
                    }
                    return occurrences;
                })
                .sort((a, b) => a.occurrence.getTime() - b.occurrence.getTime());

            if (upcomingAlarms.length > 0) {
                alarmBox.innerHTML = upcomingAlarms.map(alarm => {
                    return `<div class="flex justify-between items-center"><span>${alarm.icon || 'ğŸ””'} ${alarm.name}</span><span class="font-semibold text-green-500">${alarm.occurrence.toLocaleString('ko-KR', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}</span></div>`;
                }).join('');
            } else {
                alarmBox.innerHTML = '<p class="text-gray-500">3ì¼ ì´ë‚´ì˜ ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // --- [ìˆ˜ì •] 3.8 -> 3.9. ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜ì •) ---
        function renderCards() {
            // [ì‹ ê·œ] ìŠ¤í¬ë¡¤ ì í”„ ë°©ì§€ë¥¼ ìœ„í•´ í˜„ì¬ ë†’ì´ë¥¼ min-heightë¡œ ì„¤ì •
            const mainHeight = mainContent.scrollHeight;
            mainContent.style.minHeight = `${mainHeight}px`;

            // [ì¶”ê°€] ë Œë”ë§ ì „, ê¸°ì¡´ì˜ Sortable ì¸ìŠ¤í„´ìŠ¤ ì œê±°
            destroySortable();
            mainContent.innerHTML = ''; // ë©”ì¸ ì½˜í…ì¸  ì´ˆê¸°í™”
            
            const categoriesToRender = [];
            const popularSites = getPopularSites(); // ì¸ê¸° ì‚¬ì´íŠ¸ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°

            // [ìˆ˜ì •] 'ìì£¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ì´íŠ¸'ê°€ í•­ìƒ í‘œì‹œë˜ë„ë¡ ë³€ê²½
            categoriesToRender.push({
                category: "ìì£¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ì´íŠ¸",
                sites: popularSites,
                isPopularCategory: true // ì´ ì¹´í…Œê³ ë¦¬ê°€ íŠ¹ë³„í•˜ë‹¤ëŠ” í”Œë˜ê·¸
            });

            // ì‹¤ì œ siteDataì˜ ì¹´í…Œê³ ë¦¬ë“¤ì„ ì¶”ê°€
            categoriesToRender.push(...siteData);

            // [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ ë Œë”ë§ (siteData ê¸°ì¤€, ì¸ê¸° ì‚¬ì´íŠ¸ ì œì™¸)
            renderCategoryNav();

            if (categoriesToRender.length === 0 && editMode) {
                mainContent.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">'ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</p>`;
            } else if (categoriesToRender.length === 0 && !editMode) {
                 mainContent.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">í‘œì‹œí•  ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ í•˜ë‹¨ì˜ âš™ï¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´í…Œê³ ë¦¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>`;
            }

            categoriesToRender.forEach((category, currentRenderIndex) => { // categoryIndex ëŒ€ì‹  currentRenderIndex ì‚¬ìš©
                
                // [ìˆ˜ì •] 'ìì£¼ ë°©ë¬¸'ì´ ì•„ë‹ ê²½ìš°, ì‹¤ì œ siteData ì¸ë±ìŠ¤ë¥¼ ì°¾ìŒ
                let realCategoryIndex = -1;
                if (!category.isPopularCategory) {
                    // siteDataì—ì„œ í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ë™ì¼í•œ ê°ì²´ë¥¼ ì°¾ì•„ ì¸ë±ìŠ¤ë¥¼ êµ¬í•¨
                    // (ì°¸ì¡° ë™ì¼ì„± ë¹„êµ)
                    realCategoryIndex = siteData.findIndex(c => c === category);
                }

                const categoryId = category.isPopularCategory ? 'category-popular' : `category-${realCategoryIndex}`;
                
                // [ë²„ê·¸ ìˆ˜ì •] realCategoryIndexê°€ -1 (ì¦‰, ì¸ê¸° ì¹´í…Œê³ ë¦¬)ì¼ ë•Œ category-popularë¥¼ ì‚¬ìš©í•˜ë„ë¡
                const sectionId = category.isPopularCategory ? 'category-popular' : `category-${realCategoryIndex}`;

                // 1. ì¹´í…Œê³ ë¦¬ ì„¹ì…˜
                const section = document.createElement('section');
                section.id = sectionId; 
                section.className = 'mb-12 pt-4';

                // 2. ì¹´í…Œê³ ë¦¬ ì œëª© ì˜ì—­
                const titleWrapper = document.createElement('div');
                titleWrapper.className = 'category-title-wrapper flex justify-between items-center mb-4 pb-2 border-b-2 border-blue-500 dark:border-blue-400';
                // ì¸ê¸° ì¹´í…Œê³ ë¦¬ëŠ” ë“œë˜ê·¸ í•¸ë“¤ ì—†ìŒ
                if (editMode && !category.isPopularCategory) {
                    titleWrapper.classList.add('cursor-move');
                }
                // [ì‹ ê·œ] ì €ì¥ëœ ìƒ‰ìƒì´ ìˆìœ¼ë©´ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½
                let categoryTitleStyle = '';
                if (category.color && !category.isPopularCategory) {
                    titleWrapper.style.borderColor = category.color;
                    categoryTitleStyle = `style="color: ${category.color}"`; // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ìŠ¤íƒ€ì¼ ì¶”ê°€
                }
                
                titleWrapper.innerHTML = `
                    <h2 class="text-2xl font-semibold" ${categoryTitleStyle}>${category.category}</h2>
                    ${category.isPopularCategory ? `
                    <button id="clear-clicks-btn" class="p-1 text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors" title="ëª¨ë“  í´ë¦­ ìˆ˜ ì´ˆê¸°í™”">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                    ` : `
                    <div class="edit-controls-inline space-x-2">
                        <button class="add-site-btn p-1 text-green-500 hover:text-green-700" data-category-index="${realCategoryIndex}" title="ì´ ì¹´í…Œê³ ë¦¬ì— ì•„ì´í…œ ì¶”ê°€">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </button>
                        <button class="edit-category-btn p-1 text-blue-500 hover:text-blue-700" data-category-index="${realCategoryIndex}" title="ì¹´í…Œê³ ë¦¬ ì´ë¦„ ìˆ˜ì •">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                        </button>
                        <button class="delete-category-btn p-1 text-red-500 hover:text-red-700" data-category-index="${realCategoryIndex}" title="ì¹´í…Œê³ ë¦¬ ì‚­ì œ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                    `}
                `;
                section.appendChild(titleWrapper);

                // 3. ì¹´ë“œ ê·¸ë¦¬ë“œ
                const grid = document.createElement('div');
                grid.className = 'card-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6';
                // ì¸ê¸° ì¹´í…Œê³ ë¦¬ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­ ëŒ€ìƒ ì•„ë‹˜
                if (!category.isPopularCategory) {
                    grid.dataset.categoryIndex = realCategoryIndex; // [ìˆ˜ì •] ì‹¤ì œ ì¸ë±ìŠ¤ ì‚¬ìš©
                }

                // [ìˆ˜ì •] sitesê°€ ì—†ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„ (íŠ¹íˆ 'events' íƒ€ì…)
                const sites = category.sites || [];

                if (sites.length === 0 && editMode && !category.isPopularCategory) {
                     grid.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">'ì•„ì´í…œ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ì•„ì´í…œì„ ì¶”ê°€í•˜ì„¸ìš”.</p>`;
                } else if (sites.length === 0 && !editMode && category.isPopularCategory) {
                    grid.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">ì•„ì§ ìì£¼ ë°©ë¬¸í•œ ì‚¬ì´íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´íŠ¸ë¥¼ í´ë¦­í•˜ì—¬ ë°©ë¬¸ íšŸìˆ˜ë¥¼ ëŠ˜ë ¤ë³´ì„¸ìš”!</p>`;
                } else if (sites.length === 0 && !editMode && !category.isPopularCategory) {
                    grid.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">ì´ ì¹´í…Œê³ ë¦¬ì— í‘œì‹œí•  ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }


                // 4. ê° ì‚¬ì´íŠ¸/ì´ë²¤íŠ¸ ì¹´ë“œ ìƒì„±
                sites.forEach((site, siteIndex) => {
                    // [ìˆ˜ì •] ì¸ê¸° ì¹´í…Œê³ ë¦¬ì¸ ê²½ìš°, íƒ€ì…ì„ 'links'ë¡œ ê°•ì œ
                    const categoryType = category.isPopularCategory ? 'links' : (category.type || 'links');

                    if (categoryType === 'links') {
                        // [ê¸°ì¡´] ì‚¬ì´íŠ¸ ì¹´ë“œ ë Œë”ë§ ë¡œì§
                        const card = document.createElement('a');
                        card.href = site.url;
                        card.target = '_blank';
                        card.rel = 'noopener noreferrer';
                        card.className = `
                            site-card relative block p-5 bg-white dark:bg-gray-800 
                            rounded-xl shadow-md hover:shadow-lg dark:hover:shadow-gray-700/50 
                            transition-all duration-300 transform hover:scale-[1.03]
                        `;
                        if (editMode && !category.isPopularCategory) {
                            card.classList.add('cursor-move');
                        }

                        card.addEventListener('click', (e) => {
                            if (!editMode) {
                                // [ìˆ˜ì •] í´ë¦­ ì¹´ìš´íŠ¸ ë¡œì§ (ì¸ê¸°/ì¼ë°˜ êµ¬ë¶„)
                                let targetCategoryIndex;
                                let targetSiteIndex;

                                if (category.isPopularCategory) {
                                    // ì¸ê¸° ì¹´í…Œê³ ë¦¬ í´ë¦­ ì‹œ, ì›ë³¸ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©
                                    targetCategoryIndex = site.originalCategoryIndex;
                                    targetSiteIndex = site.originalSiteIndex;
                                } else {
                                    // ì¼ë°˜ ì¹´í…Œê³ ë¦¬ í´ë¦­ ì‹œ, í˜„ì¬ ì‹¤ì œ ì¸ë±ìŠ¤ ì‚¬ìš©
                                    targetCategoryIndex = realCategoryIndex;
                                    targetSiteIndex = siteIndex;
                                }

                                if (targetCategoryIndex !== undefined && targetSiteIndex !== undefined &&
                                    siteData[targetCategoryIndex] && 
                                    siteData[targetCategoryIndex].type === 'links' && // [ìˆ˜ì •] ë§í¬ íƒ€ì…ì¼ ë•Œë§Œ
                                    siteData[targetCategoryIndex].sites[targetSiteIndex]) {
                                    
                                    // [ìˆ˜ì •] clicks ì†ì„±ì´ ì—†ìœ¼ë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™” í›„ ì¦ê°€
                                    if (typeof siteData[targetCategoryIndex].sites[targetSiteIndex].clicks !== 'number') {
                                        siteData[targetCategoryIndex].sites[targetSiteIndex].clicks = 0;
                                    }
                                    
                                    siteData[targetCategoryIndex].sites[targetSiteIndex].clicks++;
                                    // [ìˆ˜ì •] ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥, í† ìŠ¤íŠ¸ ì•Œë¦¼ ë”
                                    saveData(true, { scrollY: window.scrollY, showToast: false });
                                }
                            }
                        });

                        card.innerHTML = `
                            ${category.isPopularCategory ? '' : `
                            <div class="edit-card-controls absolute top-2 right-2 space-x-1">
                                <button class="edit-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-blue-600 hover:text-blue-800"
                                        data-category-index="${realCategoryIndex}" data-site-index="${siteIndex}" title="ì‚¬ì´íŠ¸ ìˆ˜ì •">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                                </button>
                                <button class="delete-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-red-600 hover:text-red-800"
                                        data-category-index="${realCategoryIndex}" data-site-index="${siteIndex}" title="ì‚¬ì´íŠ¸ ì‚­ì œ">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            `}
                            <div class="flex items-center space-x-4">
                                ${(site.icon && (site.icon.startsWith('data:image') || site.icon.startsWith('http')))
                                    ? `<img src="${site.icon}" alt="${site.name} icon" class="flex-shrink-0 w-10 h-10 rounded-lg object-cover">`
                                    : `<span class="flex-shrink-0 text-3xl w-10 h-10 flex items-center justify-center">${site.icon || 'ğŸŒ'}</span>`
                                }
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">${site.name}</h3>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">${site.description || ''}</p>
                                    ${category.isPopularCategory && site.clicks > 0 ? `<p class="text-xs text-gray-500 dark:text-gray-400 mt-1">í´ë¦­: ${site.clicks}</p>` : ''}
                                </div>
                            </div>
                        `;
                        grid.appendChild(card);

                    } else if (categoryType === 'events') {
                        // [ì‹ ê·œ] ì´ë²¤íŠ¸ ì¹´ë“œ ë Œë”ë§ ë¡œì§
                        const card = document.createElement('div');
                        card.className = `site-card relative block p-5 bg-white dark:bg-gray-800 rounded-xl shadow-md`;
                        if (editMode) {
                            card.classList.add('cursor-move');
                        }

                        let eventInfoHtml = '';
                        if (site.targetDate) {
                            const todayMidnight = new Date(new Date().setHours(0, 0, 0, 0));
                            const targetDate = new Date(site.targetDate);

                            if (site.type === 'dday') {
                                const targetDateMidnight = new Date(new Date(site.targetDate).setHours(0, 0, 0, 0));
                                const diffTime = targetDateMidnight.getTime() - todayMidnight.getTime();
                                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                                
                                let ddayText = `D-${diffDays}`;
                                if (diffDays === 0) ddayText = 'D-Day';
                                else if (diffDays < 0) ddayText = `D+${Math.abs(diffDays)}`;
                                
                                eventInfoHtml = `<h3 class="text-xl font-bold text-red-500">${ddayText}</h3>`;
                            } else if (site.type === 'alarm' && !isNaN(targetDate.getTime())) { // [ìˆ˜ì •] ìœ íš¨í•œ ë‚ ì§œì¸ì§€ í™•ì¸
                                const time = targetDate.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                                switch (site.recurrence) {
                                    case 'daily':
                                        eventInfoHtml = `<p class="text-sm font-medium text-gray-600 dark:text-gray-400">ë§¤ì¼ ${time}</p>`;
                                        break;
                                    case 'weekly':
                                        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                                        const day = days[targetDate.getDay()];
                                        eventInfoHtml = `<p class="text-sm font-medium text-gray-600 dark:text-gray-400">ë§¤ì£¼ ${day}ìš”ì¼ ${time}</p>`;
                                        break;
                                    case 'monthly':
                                        const date = targetDate.getDate();
                                        eventInfoHtml = `<p class="text-sm font-medium text-gray-600 dark:text-gray-400">ë§¤ì›” ${date}ì¼ ${time}</p>`;
                                        break;
                                    case 'yearly':
                                        const month = targetDate.getMonth() + 1;
                                        const dayOfMonth = targetDate.getDate();
                                        eventInfoHtml = `<p class="text-sm font-medium text-gray-600 dark:text-gray-400">ë§¤ë…„ ${month}ì›” ${dayOfMonth}ì¼ ${time}</p>`;
                                        break;
                                    default: // 'none'
                                        eventInfoHtml = `<p class="text-sm font-medium text-gray-600 dark:text-gray-400">${targetDate.toLocaleString('ko-KR')}</p>`;
                                        break;
                                }
                            }
                        }

                        card.innerHTML = `
                            <div class="edit-card-controls absolute top-2 right-2 space-x-1">
                                <button class="edit-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-blue-600 hover:text-blue-800"
                                        data-category-index="${realCategoryIndex}" data-site-index="${siteIndex}" title="ì´ë²¤íŠ¸ ìˆ˜ì •">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                                </button>
                                <button class="delete-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-red-600 hover:text-red-800"
                                        data-category-index="${realCategoryIndex}" data-site-index="${siteIndex}" title="ì´ë²¤íŠ¸ ì‚­ì œ">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="flex-shrink-0 text-3xl w-10 h-10 flex items-center justify-center">${site.icon || 'ğŸ“Œ'}</span>
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">${site.name}</h3>
                                    ${eventInfoHtml}
                                </div>
                            </div>
                        `;
                        grid.appendChild(card);
                    }
                });

                section.appendChild(grid);
                mainContent.appendChild(section);
            });

            // [ì¶”ê°€] ë Œë”ë§ ì™„ë£Œ í›„, ì„¤ì • ëª¨ë“œë¼ë©´ Sortable í™œì„±í™”
            if (editMode) {
                initSortable();
            }

            // [ì‹ ê·œ] ìŠ¤í¬ë¡¤ ì í”„ ë°©ì§€ìš© min-height ì†ì„± ì œê±°
            mainContent.style.minHeight = '';
        }


        // --- [ìˆ˜ì •] 3.9 -> 3.10. ì‹¤ì‹œê°„ ì‹œê³„ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function updateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            currentTimeEl.textContent = now.toLocaleString('ko-KR', options);
        }

        // --- [ìˆ˜ì •] 3.10 -> 3.11. í…Œë§ˆ í† ê¸€ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function setupThemeToggle() {
            function updateIcon() {
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden'); darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden'); darkIcon.classList.remove('hidden');
                }
            }
            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.theme = isDark ? 'dark' : 'light';
                updateIcon();
            });
            updateIcon(); // ì´ˆê¸° ì•„ì´ì½˜ ì„¤ì •
        }

        // --- [ìˆ˜ì •] 3.11 -> 3.12. ê²€ìƒ‰ ì—”ì§„ ì„¤ì • í•¨ìˆ˜ ---
        function updateSearchEngine(engine) {
            if (engine === 'google') {
                searchForm.action = 'https://www.google.com/search';
                searchInput.name = 'q';
                searchInput.placeholder = 'Google ê²€ìƒ‰...';
            } else if (engine === 'naver') {
                searchForm.action = 'https://search.naver.com/search.naver';
                searchInput.name = 'query';
                searchInput.placeholder = 'Naver ê²€ìƒ‰...';
            }
            localStorage.setItem('searchEngine', engine);
        }

        function setupSearchEngine() {
            searchEngineRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    updateSearchEngine(e.target.value);
                });
            });
            
            const savedEngine = localStorage.getItem('searchEngine') || 'google';
            document.getElementById(`search-engine-${savedEngine}`).checked = true;
            updateSearchEngine(savedEngine);
        }


        // --- [ìˆ˜ì •] 3.12 -> 3.13. ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜ ---
        function showSiteModal(categoryIndex, siteIndex = null) {
            siteForm.reset(); // í¼ ì´ˆê¸°í™”
            document.getElementById('category-index').value = categoryIndex;
            
            // [ì¶”ê°€] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            const preview = document.getElementById('site-icon-preview');
            preview.classList.add('hidden');
            preview.src = '';
            // [ì¶”ê°€] íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('site-icon-file').value = '';

            if (siteIndex !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                document.getElementById('site-modal-title').textContent = "ì‚¬ì´íŠ¸ ìˆ˜ì •";
                document.getElementById('site-index').value = siteIndex;
                const site = siteData[categoryIndex].sites[siteIndex];
                document.getElementById('site-name').value = site.name;
                document.getElementById('site-url').value = site.url;
                document.getElementById('site-icon').value = site.icon;
                document.getElementById('site-description').value = site.description;

                // [ì¶”ê°€] ë¯¸ë¦¬ë³´ê¸°ê°€ Base64 ì´ë¯¸ì§€ì´ê±°ë‚˜ URLì´ë©´ í‘œì‹œ
                if (site.icon && (site.icon.startsWith('data:image') || site.icon.startsWith('http'))) {
                    preview.src = site.icon;
                    preview.classList.remove('hidden');
                }

            } else {
                // ì¶”ê°€ ëª¨ë“œ
                // [ìˆ˜ì •] 'site-modal-title'ì„ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
                document.getElementById('site-modal-title').textContent = "ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€";
                // [ìˆ˜ì •] 'site-index'ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
                document.getElementById('site-index').value = ''; // ì¸ë±ìŠ¤ ë¹„ìš°ê¸°
            }
            // [ìˆ˜ì •] 'siteModal'ì„ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
            siteModal.classList.remove('modal-hidden');
        }

        /** [ì‹ ê·œ] ì´ë²¤íŠ¸ ëª¨ë‹¬ í‘œì‹œ í•¨ìˆ˜ */
        function showEventModal(categoryIndex, eventIndex = null) {
            const eventForm = document.getElementById('event-form');
            eventForm.reset();
            
            document.getElementById('event-category-index').value = categoryIndex;

            const ddayFields = document.getElementById('dday-fields');
            const alarmFields = document.getElementById('alarm-fields');

            if (eventIndex !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                document.getElementById('event-modal-title').textContent = "ì´ë²¤íŠ¸ ìˆ˜ì •";
                document.getElementById('event-index').value = eventIndex;
                const event = siteData[categoryIndex].sites[eventIndex];
                
                document.getElementById('event-type').value = event.type;
                document.getElementById('event-name').value = event.name;
                document.getElementById('event-icon').value = event.icon;

                if (event.type === 'dday') {
                    ddayFields.classList.remove('hidden');
                    alarmFields.classList.add('hidden');
                    document.getElementById('event-date').value = event.targetDate;
                } else if (event.type === 'alarm') {
                    ddayFields.classList.add('hidden');
                    alarmFields.classList.remove('hidden');
                    document.getElementById('event-datetime').value = event.targetDate;
                    document.getElementById('event-recurrence').value = event.recurrence || 'none'; // [ì‹ ê·œ] ë°˜ë³µ ì„¤ì •
                }

            } else {
                // ì¶”ê°€ ëª¨ë“œ
                document.getElementById('event-modal-title').textContent = "ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€";
                document.getElementById('event-index').value = '';
                document.getElementById('event-recurrence').value = 'none'; // [ì‹ ê·œ] ê¸°ë³¸ê°’
                // ê¸°ë³¸ìœ¼ë¡œ D-Day í•„ë“œ í‘œì‹œ
                ddayFields.classList.remove('hidden');
                alarmFields.classList.add('hidden');
            }
            
            eventModal.classList.remove('modal-hidden');
        }

        // [ìˆ˜ì •] ëˆ„ë½ë˜ì—ˆë˜ showCategoryModal í•¨ìˆ˜ ì¶”ê°€
        function showCategoryModal(categoryIndex = null) {
            categoryForm.reset();
            if (categoryIndex !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                document.getElementById('category-modal-title').textContent = "ì¹´í…Œê³ ë¦¬ ìˆ˜ì •";
                document.getElementById('edit-category-index').value = categoryIndex;
                document.getElementById('category-name').value = siteData[categoryIndex].category;
                document.getElementById('category-color').value = siteData[categoryIndex].color || '#3B82F6';
                document.getElementById('category-type').value = siteData[categoryIndex].type || 'links'; // íƒ€ì… ì„¤ì •
            } else {
                // ì¶”ê°€ ëª¨ë“œ
                document.getElementById('category-modal-title').textContent = "ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€";
                document.getElementById('edit-category-index').value = '';
                document.getElementById('category-color').value = '#3B82F6'; // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ì‹œ ê¸°ë³¸ ìƒ‰ìƒ
                document.getElementById('category-type').value = 'links'; // ê¸°ë³¸ íƒ€ì…ì€ 'links'
            }
            categoryModal.classList.remove('modal-hidden');
        }

        // [ì¶”ê°€] ì œëª© ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        function showTitleModal() {
            document.getElementById('dashboard-title-input').value = dashboardTitle;
            titleModal.classList.remove('modal-hidden');
        }

        // [ì‹ ê·œ] ì‚­ì œ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
        function showConfirmModal(message, onConfirm) {
            // 1. Get the original modal
            const originalModal = document.getElementById('confirm-modal');

            // 2. Clone it to work with a fresh copy and remove all old listeners implicitly
            const newModal = originalModal.cloneNode(true);

            // 3. Find elements within the NEW clone
            const messageEl = newModal.querySelector('#confirm-modal-message');
            const confirmBtn = newModal.querySelector('#confirm-delete-btn');
            const cancelBtn = newModal.querySelector('#cancel-confirm-btn');

            // 4. Configure the cloned elements
            messageEl.innerHTML = message;
            
            cancelBtn.addEventListener('click', hideConfirmModal);
            confirmBtn.addEventListener('click', () => {
                hideConfirmModal();
                onConfirm();
            });
            newModal.addEventListener('click', (e) => {
                if (e.target === newModal) {
                    hideConfirmModal();
                }
            });

            // 5. Replace the old modal with the new one in the DOM
            originalModal.parentNode.replaceChild(newModal, originalModal);

            // 6. Show the new modal
            newModal.classList.remove('modal-hidden');
        }

        function hideConfirmModal() {
            document.getElementById('confirm-modal').classList.add('modal-hidden');
        }

        function hideModals() {
            siteModal.classList.add('modal-hidden');
            categoryModal.classList.add('modal-hidden');
            titleModal.classList.add('modal-hidden');
            eventModal.classList.add('modal-hidden'); // [ì‹ ê·œ]
            hideConfirmModal(); // [ì‹ ê·œ] ì‚­ì œ í™•ì¸ ëª¨ë‹¬ë„ í•¨ê»˜ ë‹«ê¸°
        }

        // --- [ìˆ˜ì •] 3.13 -> 3.14. ì„¤ì • ëª¨ë“œ í† ê¸€ ---
        function toggleSettings() {
            editMode = !editMode;
            document.body.classList.toggle('edit-mode');
            
            // ì•„ì´ì½˜ ì „í™˜
            settingsIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');

            // ì„¤ì • ëª¨ë“œì¼ ë•Œ ì¹´ë“œ ë§í¬ ë¹„í™œì„±í™” (í´ë¦­ ë°©ì§€)
            const cards = document.querySelectorAll('.site-card');
            cards.forEach(card => {
                card.style.pointerEvents = editMode ? 'none' : 'auto';
            });
            
            // [ìˆ˜ì •] ë Œë”ë§ì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ Sortable ì¸ìŠ¤í„´ìŠ¤ ë“±ì„ ê°±ì‹ 
            renderCards();
        }

        // --- [ì¶”ê°€] 3.14 -> 3.15. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì •ë ¬ í•¨ìˆ˜ ---
        function initSortable() {
            // 1. ì¹´í…Œê³ ë¦¬ ì •ë ¬
            categorySortable = new Sortable(mainContent, {
                animation: 150,
                handle: '.category-title-wrapper', // ì¹´í…Œê³ ë¦¬ ì œëª© ì˜ì—­ì„ í•¸ë“¤ë¡œ ì‚¬ìš©
                ghostClass: 'ghost-category',
                // [ìˆ˜ì •] 'ìì£¼ ë°©ë¬¸' ì¹´í…Œê³ ë¦¬ëŠ” ë“œë˜ê·¸ ëŒ€ìƒì—ì„œ ì œì™¸
                filter: '#category-popular', 
                preventOnFilter: true,
                onEnd: (evt) => {
                    const scrollY = window.scrollY;

                    // [ë²„ê·¸ ìˆ˜ì •] 'ìì£¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ì´íŠ¸' ì¹´í…Œê³ ë¦¬ê°€ í‘œì‹œë  ë•Œ ì¸ë±ìŠ¤ ë³´ì •
                    const popularCategoryExists = document.getElementById('category-popular') !== null;
                    const oldIndex = popularCategoryExists ? evt.oldIndex - 1 : evt.oldIndex;
                    const newIndex = popularCategoryExists ? evt.newIndex - 1 : evt.newIndex;

                    // 'ìì£¼ ë°©ë¬¸í•˜ëŠ” ì‚¬ì´íŠ¸' ì¹´í…Œê³ ë¦¬ ìì²´ë¥¼ ë“œë˜ê·¸í•˜ë ¤ëŠ” ê²½ìš°(oldIndexê°€ -1)ë¥¼ ë°©ì§€
                    if (oldIndex < 0 || newIndex < 0) {
                        // ì˜ëª»ëœ ë“œë˜ê·¸ì´ë¯€ë¡œ UIë¥¼ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦¬ê¸° ìœ„í•´ ë‹¤ì‹œ ë Œë”ë§
                        renderCards();
                        window.scrollTo(0, scrollY);
                        return;
                    }

                    // siteData ë°°ì—´ ìˆœì„œ ë³€ê²½
                    const item = siteData.splice(oldIndex, 1)[0];
                    siteData.splice(newIndex, 0, item);
                    
                    // ì €ì¥ ë° í™”ë©´ ë‹¤ì‹œ ë Œë”ë§ (ì¸ë±ìŠ¤ ë™ê¸°í™” ë° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›)
                    saveData(true, { scrollY: scrollY });
                }
            });

            // 2. ê° ì¹´í…Œê³ ë¦¬ ë‚´ ì‚¬ì´íŠ¸ ì¹´ë“œ ì •ë ¬
            document.querySelectorAll('.card-grid').forEach((grid) => {
                // [ë²„ê·¸ ìˆ˜ì •] ì¸ê¸° ì¹´í…Œê³ ë¦¬ëŠ” ì •ë ¬ ëŒ€ìƒì—ì„œ ì œì™¸
                if (grid.closest('section')?.id === 'category-popular') {
                    return;
                }
                
                // [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ íƒ€ì…ì— ë”°ë¼ ë“œë˜ê·¸ ê·¸ë£¹ ë¶„ë¦¬
                const categoryRealIndex = parseInt(grid.dataset.categoryIndex, 10);
                
                // [ìˆ˜ì •] categoryRealIndexê°€ ìœ íš¨í•œì§€ í™•ì¸
                if (isNaN(categoryRealIndex) || categoryRealIndex < 0 || !siteData[categoryRealIndex]) {
                    return;
                }

                const categoryType = siteData[categoryRealIndex].type || 'links';

                const s = new Sortable(grid, {
                    animation: 150,
                    group: categoryType === 'events' ? 'events' : 'sites', // 'sites' ê·¸ë£¹ê³¼ 'events' ê·¸ë£¹ ë¶„ë¦¬
                    ghostClass: 'ghost-card',
                    onEnd: (evt) => {
                        // [ìˆ˜ì •] ë Œë”ë§ ì „ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
                        const scrollY = window.scrollY;

                        const fromCategoryIndex = parseInt(evt.from.dataset.categoryIndex, 10);
                        const toCategoryIndex = parseInt(evt.to.dataset.categoryIndex, 10);
                        const oldIndex = evt.oldDraggableIndex;
                        const newIndex = evt.newDraggableIndex;

                        // [ìˆ˜ì •] ì¸ë±ìŠ¤ ìœ íš¨ì„± ê²€ì‚¬
                        if (isNaN(fromCategoryIndex) || isNaN(toCategoryIndex) || 
                            !siteData[fromCategoryIndex] || !siteData[toCategoryIndex]) {
                            console.error("Drag and drop index error.");
                            saveData(true, { scrollY: scrollY }); // UI ë™ê¸°í™”
                            return;
                        }

                        // 1. ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ì—ì„œ ì•„ì´í…œ ì œê±°
                        const item = siteData[fromCategoryIndex].sites.splice(oldIndex, 1)[0];
                        // 2. ìƒˆ ì¹´í…Œê³ ë¦¬ì— ì•„ì´í…œ ì¶”ê°€
                        siteData[toCategoryIndex].sites.splice(newIndex, 0, item);

                        // ì €ì¥ ë° í™”ë©´ ë‹¤ì‹œ ë Œë”ë§ (ì¸ë±ìŠ¤ ë™ê¸°í™” ë° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³µì›)
                        saveData(true, { scrollY: scrollY });
                    }
                });
                siteSortables.push(s);
            });
        }

        function destroySortable() {
            if (categorySortable) {
                categorySortable.destroy();
                categorySortable = null;
            }
            siteSortables.forEach(s => s.destroy());
            siteSortables = [];
        }


        // --- [ì¶”ê°€] 3.15. ë©”íƒ€ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ---
        async function handleFetchMetadata() {
            const urlInput = document.getElementById('site-url');
            const url = urlInput.value.trim();
            const fetchBtn = document.getElementById('fetch-metadata-btn');
            const spinner = document.getElementById('fetch-spinner');

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showToast("http:// ë˜ëŠ” https:// ë¡œ ì‹œì‘í•˜ëŠ” ì „ì²´ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.", true);
                return;
            }

            // Show spinner, hide button
            fetchBtn.classList.add('hidden');
            spinner.classList.remove('hidden');

            try {
                // [ë³´ì•ˆ/CORS ìˆ˜ì •] CORS ë¬¸ì œë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ ë²”ìš© í”„ë¡ì‹œ API (microlink.io) ì‚¬ìš©
                const response = await fetch(`https://api.microlink.io/?url=${encodeURIComponent(url)}`);
                if (!response.ok) {
                    // API ìì²´ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•œ ê²½ìš° (e.g., 404, 500)
                    throw new Error(`API ìš”ì²­ ì‹¤íŒ¨ (ìƒíƒœ ì½”ë“œ: ${response.status})`);
                }
                const data = await response.json();
                
                // [ìˆ˜ì •] microlink API ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •
                if (data.status === 'success' && data.data) {
                    const responseData = data.data; 

                    if (responseData.title) {
                        document.getElementById('site-name').value = responseData.title;
                    }
                    if (responseData.description) {
                        document.getElementById('site-description').value = responseData.description;
                    }
                    
                    // ë¡œê³  URLì„ ìš°ì„ ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê³ , ì—†ìœ¼ë©´ ì´ë¯¸ì§€ URLì„ ì‚¬ìš©
                    const iconUrl = responseData.logo?.url || responseData.image?.url;
                    if (iconUrl) {
                        document.getElementById('site-icon').value = iconUrl;
                        const preview = document.getElementById('site-icon-preview');
                        preview.src = iconUrl;
                        preview.classList.remove('hidden');
                    }
                    showToast("ì‚¬ì´íŠ¸ ì •ë³´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.");
                } else {
                     throw new Error(data.message || "APIì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }

            } catch (error) {
                console.error("Metadata fetch failed:", error);
                if (error instanceof TypeError) {
                    // ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ë˜ëŠ” CORS (ì—¬ê¸°ì„œëŠ” API ì„œë²„ ë¬¸ì œì¼ ê°€ëŠ¥ì„±)
                    showToast("í˜„ì¬ APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì‹­ì‹œìš”!", true);
                } else {
                    // APIê°€ ìœ íš¨í•˜ì§€ ì•Šì€ URL ë“±ì˜ ì´ìœ ë¡œ ì˜¤ë¥˜ë¥¼ ë°˜í™˜í•œ ê²½ìš°
                    showToast("ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì´ ì •í™•í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”.", true);
                }
            } finally {
                // Hide spinner, show button
                spinner.classList.add('hidden');
                fetchBtn.classList.remove('hidden');
            }
        }

        // --- [ì‹ ê·œ] Google Drive ì—°ë™ ê¸°ëŠ¥ (GIS ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©) ---

        // [ê°œë°œì ì„¤ì • í•„ìš”]
        // 1. Google Cloud Console(https://console.cloud.google.com/)ì—ì„œ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        // 2. 'API ë° ì„œë¹„ìŠ¤' > 'ë¼ì´ë¸ŒëŸ¬ë¦¬'ì—ì„œ 'Google Drive API'ë¥¼ ì‚¬ìš© ì„¤ì •í•©ë‹ˆë‹¤.
        // 3. 'API ë° ì„œë¹„ìŠ¤' > 'ì‚¬ìš©ì ì¸ì¦ ì •ë³´'ì—ì„œ 'OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID'ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
        //    - ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜•: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜
        //    - ìŠ¹ì¸ëœ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì›ë³¸: í˜„ì¬ ëŒ€ì‹œë³´ë“œë¥¼ í˜¸ìŠ¤íŒ…í•˜ëŠ” URL (ì˜ˆ: https://username.github.io ë˜ëŠ” http://localhost:8000 ë“±)
        // 4. 'API ë° ì„œë¹„ìŠ¤' > 'ì‚¬ìš©ì ì¸ì¦ ì •ë³´'ì—ì„œ 'API í‚¤'ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. (Drive APIëŠ” ë³´í†µ API í‚¤ê°€ í•„ìš”ì—†ì„ ìˆ˜ ìˆìœ¼ë‚˜, GAPI ë¡œë“œë¥¼ ìœ„í•´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)
        // 5. ì•„ë˜ YOUR_API_KEYì™€ YOUR_CLIENT_IDë¥¼ ìì‹ ì˜ ê°’ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.
        const API_KEY = 'AIzaSyAO8OoKfWN-fpogK_KV6BmwO1HBKEwhkjo';
        const CLIENT_ID = '699523840547-va0r836vj910aghjre2iibtuop1eusnb.apps.googleusercontent.com';

        const SCOPES = 'https://www.googleapis.com/auth/drive.appdata';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        const BACKUP_FILE_NAME = 'my-dashboard-data.json';

        let tokenClient;
        let gapiInited = false;
        let gisInited = false;
        let gapiToken = null;
        let isSilentAttempt = false; // [ì‹ ê·œ] ìë™ ë¡œê·¸ì¸ ì‹œë„ í”Œë˜ê·¸

        /** [ì‹ ê·œ] Google Drive ë¡œê·¸ì¸ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ */
        function updateGdriveButtonState() {
            const authorizeBtn = document.getElementById('gdrive-authorize-btn');
            if (!authorizeBtn) return;

            // API í‚¤ê°€ ì—†ëŠ” ê²½ìš°, ë²„íŠ¼ì„ ì˜êµ¬ì ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ê³  ë©”ì‹œì§€ í‘œì‹œ
            if (API_KEY === '' || CLIENT_ID === '') {
                authorizeBtn.disabled = true;
                authorizeBtn.textContent = 'API í‚¤ ì„¤ì • í•„ìš”';
                authorizeBtn.title = 'Google Drive API í‚¤ ë˜ëŠ” Client IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                authorizeBtn.classList.add('cursor-not-allowed', 'bg-red-400', 'dark:bg-red-800');
                authorizeBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                return;
            }

            if (gapiInited && gisInited) {
                authorizeBtn.disabled = false;
                authorizeBtn.textContent = 'Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸';
                authorizeBtn.title = 'Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ë°ì´í„°ë¥¼ ë™ê¸°í™”í•©ë‹ˆë‹¤.';
                authorizeBtn.classList.remove('cursor-not-allowed', 'bg-gray-400');
                authorizeBtn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            } else {
                authorizeBtn.disabled = true;
                authorizeBtn.textContent = 'Google API ë¡œë”© ì¤‘...';
                authorizeBtn.title = 'Google APIê°€ ë¡œë“œë  ë•Œê¹Œì§€ ì ì‹œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.';
                authorizeBtn.classList.add('cursor-not-allowed', 'bg-gray-400');
                authorizeBtn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
            }
        }

        function gapiLoaded() {
            gapi.load('client', initializeGapiClient);
        }

        async function initializeGapiClient() {
            if (API_KEY === '') {
                console.warn("API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•„ GAPI Client ì´ˆê¸°í™”ë¥¼ ê±´ë„ˆëœë‹ˆë‹¤.");
                updateGdriveButtonState(); // [ì¶”ê°€] ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                return;
            }
            try {
                await gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                });
                gapiInited = true;
                updateGdriveButtonState(); // [ì¶”ê°€] ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            } catch (error) {
                 if (error.details) {
                     console.error("GAPI Client ì´ˆê¸°í™” ì‹¤íŒ¨:", error.details);
                     showToast(`GAPI Client ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${error.details}`, true);
                 } else {
                     console.error("GAPI Client ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                     showToast("GAPI Client ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš”.", true);
                 }
            }
        }

        function gisLoaded() {
            if (!CLIENT_ID) {
                 console.error("Google Client IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                 updateGdriveButtonState(); // [ì¶”ê°€] ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                 return;
            }
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: tokenCallback, // ì‘ë‹µì„ ì²˜ë¦¬í•  ì½œë°± í•¨ìˆ˜
                });
                gisInited = true;
                updateGdriveButtonState(); // [ì¶”ê°€] ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            } catch (error) {
                console.error("GSI Client ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                showToast("GSI Client ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. Client IDë¥¼ í™•ì¸í•˜ì„¸ìš”.", true);
            }
        }

        function trySilentLogin() {
            // APIê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ 100msë§ˆë‹¤ í™•ì¸ (ìµœëŒ€ 10ì´ˆ)
            let attempts = 0;
            const maxAttempts = 100; // 100 * 100ms = 10 seconds

            function checkApis() {
                if (API_KEY === '' || CLIENT_ID === '') {
                    console.warn("API í‚¤ ë˜ëŠ” Client IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•„ ìë™ ë¡œê·¸ì¸ì„ ê±´ë„ˆëœë‹ˆë‹¤.");
                    updateSigninStatus('logged_out'); // If API keys are missing, it's truly logged out
                    return;
                }

                if (gapiInited && gisInited) {
                    console.log("APIs ready, attempting silent login.");
                    isSilentAttempt = true;
                    // 'none' í”„ë¡¬í”„íŠ¸ë¡œ ìë™ ë¡œê·¸ì¸ ì‹œë„
                    tokenClient.requestAccessToken({prompt: 'none'});
                } else if (attempts < maxAttempts) {
                    // ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
                    attempts++;
                    setTimeout(checkApis, 100);
                } else {
                    // íƒ€ì„ì•„ì›ƒ
                    console.warn("Silent login timed out waiting for GAPI/GSI.");
                    updateSigninStatus('reauth_needed', "Google API ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” íƒ€ì„ì•„ì›ƒ. ì¬ì¸ì¦ í•„ìš”."); // Indicate re-auth needed
                }
            }
            checkApis();
        }

        // [ìˆ˜ì •] tokenCallback í•¨ìˆ˜ (ìë™ ë¡œê·¸ì¸ ë¡œì§ ì ìš©)
        function tokenCallback(tokenResponse) {
            if (tokenResponse && tokenResponse.access_token) {
                // 1. ë¡œê·¸ì¸ ì„±ê³µ (ìˆ˜ë™ ë˜ëŠ” ìë™)
                gapiToken = tokenResponse;
                gapi.client.setToken(gapiToken);
                
                // Get file info and update status
                findOrCreateFile().then(file => {
                    updateSigninStatus('logged_in', '', file);
                });

                // [ì‹ ê·œ] ë¡œê·¸ì¸ ìƒíƒœ localStorageì— ì €ì¥
                localStorage.setItem('gdrive_user_logged_in', 'true');
                
                // [ì‹ ê·œ] ìˆ˜ë™ ë¡œê·¸ì¸ì¼ ë•Œë§Œ í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
                if (!isSilentAttempt) {
                    showToast("Google ê³„ì •ì— ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
            } else {
                // 2. ë¡œê·¸ì¸ ì‹¤íŒ¨
                console.error("Access token not found in response:", tokenResponse);
                
                if (isSilentAttempt) {
                    // 2a. [ì‹ ê·œ] ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨
                    // ì‚¬ìš©ìì˜ ìš”ì²­ëŒ€ë¡œ localStorageë¥¼ ì‚­ì œí•˜ì§€ ì•ŠìŒ
                    // UIë§Œ ë¡œê·¸ì•„ì›ƒ ìƒíƒœë¡œ ë³€ê²½í•˜ì—¬, í•„ìš”ì‹œ ìˆ˜ë™ ë¡œê·¸ì¸ì„ ìœ ë„
                    console.log("Silent login failed. User needs to re-authenticate manually.");
                    updateSigninStatus('reauth_needed', "Google ê³„ì • ì¬ì¸ì¦ í•„ìš”");
                    gapiToken = null; // Clear token
                    gapi.client.setToken(null);
                } else {
                    // 2b. ìˆ˜ë™ ë¡œê·¸ì¸ ì‹¤íŒ¨
                    showToast("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
                    updateSigninStatus('logged_out'); // Explicit manual login failure
                }
            }
            
            // [ì‹ ê·œ] ì‹œë„ í”Œë˜ê·¸ ì´ˆê¸°í™”
            isSilentAttempt = false;
        }


        function updateSigninStatus(status, statusMessage = '', file = null) { // Added file parameter
            const authorizeBtn = document.getElementById('gdrive-authorize-btn');
            const signoutContainer = document.getElementById('gdrive-signout-container');
            const gdriveActionsContainer = document.getElementById('gdrive-actions-container');
            const statusEl = document.getElementById('gdrive-status');
            // const connectionStatusEl = document.getElementById('gdrive-connection-status'); // Removed

            let timestamp = '';
            if (file && file.modifiedTime) {
                const date = new Date(file.modifiedTime);
                const dateString = date.toLocaleString('ko-KR', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit'
                });
                timestamp = ` (íŒŒì¼ ìˆ˜ì •ì¼: ${dateString})`;
            } else if (status === 'logged_in') {
                timestamp = ` (íŒŒì¼ ì—†ìŒ)`;
            }

            if (status === 'logged_in') {
                authorizeBtn.style.display = 'none';
                signoutContainer.style.display = 'flex';
                gdriveActionsContainer.style.display = 'grid';
                statusEl.textContent = (statusMessage || `Google drive connect`) + timestamp; // Consolidated
                // No need for connectionStatusEl here
            } else { // 'logged_out' and 'reauth_needed' will be handled here
                authorizeBtn.style.display = 'block';
                signoutContainer.style.display = 'none';
                gdriveActionsContainer.style.display = 'none';
                // No need for connectionStatusEl here
                if (status === 'reauth_needed') {
                    statusEl.textContent = (statusMessage || 'Google drive disconnect (ì¬ì¸ì¦ í•„ìš”)'); // Consolidated
                } else { // 'logged_out'
                    statusEl.textContent = (statusMessage || 'Google drive disconnect'); // Consolidated
                }
            }
        }
        
        function handleApiError(error, customMessage) {
            console.error(customMessage, error);
            let message = customMessage;
            if (error.result && error.result.error) {
                message = `${customMessage}: ${error.result.error.message}`;
            } else if (error.message) {
                message = `${customMessage}: ${error.message}`;
            }
            showToast(message, true);
        }

        // [ìˆ˜ì •] ìˆ˜ë™ ë¡œê·¸ì¸ (handleAuthClick)
        function handleAuthClick() {
            if (API_KEY === '' || CLIENT_ID === '') {
                showToast("Google Drive API í‚¤ ë˜ëŠ” Client IDê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½”ë“œ ë‚´ ì•ˆë‚´ë¥¼ í™•ì¸í•˜ì„¸ìš”.", true);
                return;
            }
            if (gapiInited && gisInited) {
                isSilentAttempt = false; // [ì‹ ê·œ] ìˆ˜ë™ ë¡œê·¸ì¸ í”Œë˜ê·¸ ì„¤ì •
                tokenClient.requestAccessToken({prompt: ''}); // prompt: '' (ë˜ëŠ” ìƒëµ)ëŠ” ì‚¬ìš©ì ìƒí˜¸ì‘ìš©(íŒì—…)ì„ í—ˆìš©
            } else {
                showToast("Google APIê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", true);
            }
        }

        // [ìˆ˜ì •] ë¡œê·¸ì•„ì›ƒ (handleSignoutClick)
        function handleSignoutClick() {
            // [ì‹ ê·œ] ë¡œê·¸ì•„ì›ƒ ì‹œ localStorage í”Œë˜ê·¸ ì¦‰ì‹œ ì œê±°
            localStorage.removeItem('gdrive_user_logged_in');

            if (gapiToken) {
                // í† í°ì´ ìˆìœ¼ë©´ Googleì—ì„œ í† í° í•´ì§€
                google.accounts.oauth2.revoke(gapiToken.access_token, () => {
                    gapiToken = null;
                    gapi.client.setToken(null);
                    updateSigninStatus('logged_out');
                    showToast("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.");
                });
            } else {
                // í† í°ì´ ì—†ë”ë¼ë„ (ì˜ˆ: ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨ ìƒíƒœ) UIëŠ” í™•ì‹¤íˆ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
                updateSigninStatus('logged_out');
            }
        }


        async function findOrCreateFile() {
            try {
                const response = await gapi.client.drive.files.list({
                    spaces: 'appDataFolder',
                    fields: 'files(id, name, modifiedTime)',
                    q: `name='${BACKUP_FILE_NAME}' and trashed=false`
                });
                const files = response.result.files;
                if (files && files.length > 0) {
                    return files[0];
                } else {
                    const fileMetadata = {
                        name: BACKUP_FILE_NAME,
                        parents: ['appDataFolder']
                    };
                    const createResponse = await gapi.client.drive.files.create({
                        resource: fileMetadata,
                        fields: 'id, modifiedTime'
                    });
                    return createResponse.result;
                }
            } catch (error) {
                handleApiError(error, "ë°±ì—… íŒŒì¼ ê²€ìƒ‰ ë˜ëŠ” ìƒì„± ì‹¤íŒ¨");
                return null;
            }
        }

        async function exportToGoogleDrive() {
            if (!gapiToken) {
                showToast("Google ê³„ì •ì— ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", true);
                handleAuthClick();
                return;
            }
            showToast("Google Driveì— ë‚´ë³´ë‚´ëŠ” ì¤‘...", false);
            const file = await findOrCreateFile();
            if (!file || !file.id) return;
            const fileId = file.id;

            const dataToExport = {
                dashboardData: JSON.parse(localStorage.getItem('myDashboardData') || '{}'),
                theme: localStorage.getItem('theme') || 'light',
                searchEngine: localStorage.getItem('searchEngine') || 'google',
                zoomLevel: localStorage.getItem('dashboardZoomLevel') || '1.0',
                font: localStorage.getItem('dashboardFont') || 'default'
            };
            const fileContent = JSON.stringify(dataToExport, null, 2);

            const boundary = '-------314159265358979323846';
            const delimiter = `\r\n--${boundary}\r\n`;
            const close_delim = `\r\n--${boundary}--`;

            const metadata = {
                name: BACKUP_FILE_NAME,
                mimeType: 'application/json'
            };

            const multipartRequestBody =
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(metadata) +
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                fileContent +
                close_delim;

            try {
                await gapi.client.request({
                    path: `/upload/drive/v3/files/${fileId}`,
                    method: 'PATCH',
                    params: { uploadType: 'multipart' },
                    headers: { 'Content-Type': `multipart/related; boundary="${boundary}"` },
                    body: multipartRequestBody
                });
                showToast("Google Driveì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥í–ˆìŠµë‹ˆë‹¤.");
                // Refetch file info to update timestamp
                findOrCreateFile().then(file => {
                    updateSigninStatus('logged_in', '', file);
                });
            } catch (error) {
                handleApiError(error, "Google Drive ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨");
            }
        }

        async function importFromGoogleDrive() {
            if (!gapiToken) {
                showToast("Google ê³„ì •ì— ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.", true);
                handleAuthClick();
                return;
            }
            showToast("Google Driveì—ì„œ ê°€ì ¸ì˜¤ëŠ” ì¤‘...", false);
            const file = await findOrCreateFile();
            if (!file || !file.id) return;
            const fileId = file.id;

            try {
                const response = await gapi.client.drive.files.get({
                    fileId: fileId,
                    alt: 'media'
                });

                if (Object.keys(response.result).length === 0) {
                    showToast("Google Driveì— ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë‚´ë³´ë‚´ê¸°ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.", true);
                    return;
                }

                const importedData = response.result;
                if (importedData && importedData.dashboardData) {
                    localStorage.setItem('myDashboardData', JSON.stringify(importedData.dashboardData));
                    localStorage.setItem('theme', importedData.theme || 'light');
                    localStorage.setItem('searchEngine', importedData.searchEngine || 'google');
                    localStorage.setItem('dashboardZoomLevel', importedData.zoomLevel || '1.0');
                    localStorage.setItem('dashboardFont', importedData.font || 'default');

                    showToast("ì„¤ì •ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showToast("ê°€ì ¸ì˜¨ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.", true);
                }
            } catch (error) {
                handleApiError(error, "Google Drive ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨");
            }
        }


        // --- [ìˆ˜ì •] 3.15 -> 3.16. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        function setupEventListeners() {
            // [ì‹ ê·œ] ì‚¬ì´íŠ¸ ì •ë³´ ìë™ì™„ì„± ë²„íŠ¼
            document.getElementById('fetch-metadata-btn').addEventListener('click', handleFetchMetadata);

            // [ì‹ ê·œ] ì‚¬ì´íŠ¸ ê²€ìƒ‰ í† ê¸€ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            const toggleSiteSearchBtn = document.getElementById('toggle-site-search-btn');
            const siteFilterInput = document.getElementById('site-filter-input');

            if (toggleSiteSearchBtn && siteFilterInput) {
                toggleSiteSearchBtn.addEventListener('click', () => {
                    siteFilterInput.focus();
                });
            }

            // [ì‹ ê·œ] ì‚¬ì´íŠ¸ í•„í„°ë§
            const filterInput = document.getElementById('site-filter-input');
            if (filterInput) {
                filterInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase().trim();
                    const categories = document.querySelectorAll('#main-content section');

                    categories.forEach(category => {
                        const sites = category.querySelectorAll('.site-card');
                        let isCategoryVisible = false;

                        sites.forEach(site => {
                            const name = site.querySelector('h3').textContent.toLowerCase();
                            const description = site.querySelector('p').textContent.toLowerCase();
                            // [ì‹ ê·œ] URLë„ ê²€ìƒ‰ ëŒ€ìƒì— í¬í•¨
                            const url = site.href.toLowerCase();

                            if (name.includes(searchTerm) || description.includes(searchTerm) || url.includes(searchTerm)) {
                                site.classList.remove('hidden');
                                isCategoryVisible = true;
                            } else {
                                site.classList.add('hidden');
                            }
                        });

                        if (isCategoryVisible) {
                            category.classList.remove('hidden');
                        } else {
                            category.classList.add('hidden');
                        }
                    });
                });
            }

            // [ì¶”ê°€] ë§¨ ìœ„ë¡œ ê°€ê¸° ë²„íŠ¼
            const scrollToTopBtn = document.getElementById('scroll-to-top-btn');
            if (scrollToTopBtn) {
                // í´ë¦­ ì‹œ ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
                scrollToTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // [ì‹ ê·œ] ë§¨ ì•„ë˜ë¡œ ê°€ê¸° ë²„íŠ¼
            const scrollToBottomBtn = document.getElementById('scroll-to-bottom-btn');
            if (scrollToBottomBtn) {
                scrollToBottomBtn.addEventListener('click', () => {
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                });
            }

            // [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼
            document.getElementById('zoom-in-btn').addEventListener('click', zoomIn);
            document.getElementById('zoom-out-btn').addEventListener('click', zoomOut);
            document.getElementById('zoom-reset-btn').addEventListener('click', resetZoom);
            
            // [ì‹ ê·œ] ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (í™œì„±í™”ëœ íƒ­ ì—…ë°ì´íŠ¸)
            window.addEventListener('scroll', updateActiveCategoryNav);

            // [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ í´ë¦­ ë¦¬ìŠ¤ë„ˆ (ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤)
            categoryNav.addEventListener('click', (e) => {
                const targetAnchor = e.target.closest('.category-nav-item');
                if (targetAnchor && targetAnchor.hash) {
                    e.preventDefault();
                    const targetId = targetAnchor.hash.substring(1);
                    const targetElement = document.getElementById(targetId);
                    
                    if (targetElement) {
                        // [ìˆ˜ì •] ë‚´ë¹„ê²Œì´ì…˜ì´ ë” ì´ìƒ ê³ ì •(fixed)ì´ ì•„ë‹ˆë¯€ë¡œ, ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ê³„ì‚° ë°©ì‹ì„ ë³€ê²½í•©ë‹ˆë‹¤.
                        // ì´ì œ í—¤ë”ì™€ ë‚´ë¹„ê²Œì´ì…˜ ë°”ê°€ ìŠ¤í¬ë¡¤ë˜ì–´ ì˜¬ë¼ê°€ë¯€ë¡œ, ì„¹ì…˜ ìƒë‹¨ìœ¼ë¡œ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤.
                        const targetPosition = targetElement.offsetTop - 10; // 10px ì •ë„ì˜ ì—¬ìœ 
                        
                        window.scrollTo({
                            top: targetPosition,
                            behavior: 'smooth'
                        });
                        
                        // í´ë¦­ ì‹œ ë°”ë¡œ í™œì„±í™” (ìŠ¤í¬ë¡¤ ìŠ¤íŒŒì´ë³´ë‹¤ ì¦‰ê°ì ì¸ í”¼ë“œë°± ì œê³µ)
                        updateActiveCategoryNav();
                    }
                }
            });

            // [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •]
            document.getElementById('font-selector').addEventListener('change', (e) => {
                const selectedFont = e.target.value;
                applyFont(selectedFont); // [ìˆ˜ì •] ë“œë¡­ë‹¤ìš´ ì„ íƒì€ ì˜êµ¬ ì €ì¥
                if (selectedFont !== 'custom' && selectedFont !== 'default') {
                    showToast(`í°íŠ¸ê°€ '${selectedFont}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else if (selectedFont === 'default') {
                    showToast(`ê¸°ë³¸ í°íŠ¸ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            });

            // [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ì‹œìŠ¤í…œ í°íŠ¸ 'ì ìš©' ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ (ì˜êµ¬ ì €ì¥)
            document.getElementById('apply-custom-font-btn').addEventListener('click', (e) => {
                e.preventDefault();
                const customFontName = document.getElementById('custom-font-input').value.trim();
                if (customFontName) {
                    applyFont(customFontName); // [ìˆ˜ì •] í°íŠ¸ ì ìš© ë° ì˜êµ¬ ì €ì¥
                    showToast(`ì‹œìŠ¤í…œ í°íŠ¸ '${customFontName}'(ì´)ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    showToast('í°íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                }
            });

            // ì„¤ì • ëª¨ë“œ í† ê¸€
            settingsToggleBtn.addEventListener('click', toggleSettings);

            // [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª© ìˆ˜ì • ë²„íŠ¼
            document.getElementById('edit-title-btn').addEventListener('click', showTitleModal);

            // [ì‹ ê·œ] Google Drive ì—°ë™ ë²„íŠ¼
            document.getElementById('gdrive-authorize-btn').addEventListener('click', handleAuthClick);
            document.getElementById('gdrive-signout-btn').addEventListener('click', handleSignoutClick);
            document.getElementById('import-gdrive-btn').addEventListener('click', importFromGoogleDrive);
            document.getElementById('export-gdrive-btn').addEventListener('click', exportToGoogleDrive);

            // ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ì´ë²¤íŠ¸ ìœ„ì„ (ë™ì ìœ¼ë¡œ ìƒì„±ëœ ë²„íŠ¼ ì²˜ë¦¬)
            mainContent.addEventListener('click', (e) => {
                // ì¹´ë“œ ë§í¬ í´ë¦­ ë°©ì§€ (ì„¤ì • ëª¨ë“œì¼ ë•Œ)
                if (editMode && e.target.closest('a.site-card')) {
                    e.preventDefault();
                }

                const addSiteBtn = e.target.closest('.add-site-btn');
                const editCategoryBtn = e.target.closest('.edit-category-btn');
                const deleteCategoryBtn = e.target.closest('.delete-category-btn');
                const editSiteBtn = e.target.closest('.edit-site-btn');
                const deleteSiteBtn = e.target.closest('.delete-site-btn');
                const clearClicksBtn = e.target.closest('#clear-clicks-btn');
                
                if (addSiteBtn) {
                    e.preventDefault();
                    const categoryIndex = parseInt(addSiteBtn.dataset.categoryIndex, 10);
                    // [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë‹¬ í˜¸ì¶œ
                    if (siteData[categoryIndex] && siteData[categoryIndex].type === 'events') {
                        showEventModal(categoryIndex);
                    } else {
                        showSiteModal(categoryIndex);
                    }
                } 
                else if (editCategoryBtn) {
                    e.preventDefault();
                    const categoryIndex = parseInt(editCategoryBtn.dataset.categoryIndex, 10);
                    showCategoryModal(categoryIndex);
                } 
                else if (deleteCategoryBtn) {
                    e.preventDefault();
                    const categoryIndex = parseInt(deleteCategoryBtn.dataset.categoryIndex, 10);
                    showConfirmModal(
                        `'${siteData[categoryIndex].category}' ì¹´í…Œê³ ë¦¬ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br><br><span class="text-sm text-red-500">í¬í•¨ëœ ëª¨ë“  ì‚¬ì´íŠ¸ê°€ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.</span>`,
                        () => {
                            siteData.splice(categoryIndex, 1);
                            saveData();
                        }
                    );
                } 
                else if (editSiteBtn) {
                    e.preventDefault();
                    const categoryIndex = parseInt(editSiteBtn.dataset.categoryIndex, 10);
                    const siteIndex = parseInt(editSiteBtn.dataset.siteIndex, 10);
                    // [ì‹ ê·œ] ì¹´í…Œê³ ë¦¬ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ëª¨ë‹¬ í˜¸ì¶œ
                    if (siteData[categoryIndex] && siteData[categoryIndex].type === 'events') {
                        showEventModal(categoryIndex, siteIndex);
                    } else {
                        showSiteModal(categoryIndex, siteIndex);
                    }
                } 
                else if (deleteSiteBtn) {
                    e.preventDefault();
                    const categoryIndex = parseInt(deleteSiteBtn.dataset.categoryIndex, 10);
                    const siteIndex = parseInt(deleteSiteBtn.dataset.siteIndex, 10);
                    showConfirmModal(
                        `'${siteData[categoryIndex].sites[siteIndex].name}' ì‚¬ì´íŠ¸ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`,
                        () => {
                            siteData[categoryIndex].sites.splice(siteIndex, 1);
                            saveData();
                        }
                    );
                }
                else if (clearClicksBtn) {
                    e.preventDefault();
                    showConfirmModal(
                        'ëª¨ë“  ì‚¬ì´íŠ¸ì˜ í´ë¦­ íšŸìˆ˜ë¥¼ ì •ë§ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?',
                        () => {
                            clearAllClickCounts();
                        }
                    );
                }
            });

            // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë²„íŠ¼
            addCategoryBtn.addEventListener('click', () => {
                showCategoryModal(); // ì¸ë±ìŠ¤ ì—†ì´ í˜¸ì¶œ (ì¶”ê°€ ëª¨ë“œ)
            });

            // ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼
            document.getElementById('cancel-site-btn').addEventListener('click', hideModals);
            document.getElementById('cancel-category-btn').addEventListener('click', hideModals);
            document.getElementById('cancel-title-btn').addEventListener('click', hideModals); // [ì¶”ê°€]
            document.getElementById('cancel-event-btn').addEventListener('click', hideModals); // [ì‹ ê·œ]
            
            // [ì‹ ê·œ] ì´ë²¤íŠ¸ ëª¨ë‹¬ íƒ€ì… ë³€ê²½ ì‹œ í•„ë“œ í† ê¸€
            document.getElementById('event-type').addEventListener('change', (e) => {
                const ddayFields = document.getElementById('dday-fields');
                const alarmFields = document.getElementById('alarm-fields');
                if (e.target.value === 'dday') {
                    ddayFields.classList.remove('hidden');
                    alarmFields.classList.add('hidden');
                } else {
                    ddayFields.classList.add('hidden');
                    alarmFields.classList.remove('hidden');
                }
            });

            // [ì‹ ê·œ] ì´ëª¨ì§€ ì„ íƒê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
            document.getElementById('emoji-selector').addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    document.getElementById('event-icon').value = e.target.textContent;
                }
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            siteModal.addEventListener('click', (e) => {
                if (e.target === siteModal) hideModals();
            });
            categoryModal.addEventListener('click', (e) => {
                if (e.target === categoryModal) hideModals();
            });
            titleModal.addEventListener('click', (e) => { // [ì¶”ê°€]
                if (e.target === titleModal) hideModals();
            });
            eventModal.addEventListener('click', (e) => { // [ì‹ ê·œ]
                if (e.target === eventModal) hideModals();
            });

            // [ì¶”ê°€] íŒŒì¼ ì…ë ¥ ë³€ê²½ ì´ë²¤íŠ¸ (FileReaderë¡œ Base64 ì¸ì½”ë”©)
            document.getElementById('site-icon-file').addEventListener('change', (e) => {
                const file = e.target.files[0];
                const preview = document.getElementById('site-icon-preview');
                const iconInput = document.getElementById('site-icon');

                if (!file) {
                    return;
                }

                // íŒŒì¼ í¬ê¸° ì œí•œ (1MB)
                if (file.size > 1024 * 1024) {
                    showToast('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤ (1MB ì´í•˜).', true);
                    e.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    // Base64 ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ì— ì„¤ì •
                    iconInput.value = dataUrl;
                    // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì„¤ì •
                    preview.src = dataUrl;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });

            // ì‚¬ì´íŠ¸ í¼ ì œì¶œ
            siteForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const categoryIndex = document.getElementById('category-index').value;
                const siteIndex = document.getElementById('site-index').value;
                
                const site = {
                    name: document.getElementById('site-name').value,
                    url: document.getElementById('site-url').value,
                    icon: document.getElementById('site-icon').value,
                    description: document.getElementById('site-description').value,
                };

                if (siteIndex) { // ìˆ˜ì •
                    siteData[categoryIndex].sites[siteIndex] = site;
                } else { // ì¶”ê°€
                    siteData[categoryIndex].sites.push(site);
                }
                saveData();
                hideModals();
            });

            // ì¹´í…Œê³ ë¦¬ í¼ ì œì¶œ
            categoryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const categoryIndex = document.getElementById('edit-category-index').value;
                const categoryName = document.getElementById('category-name').value;
                const categoryColor = document.getElementById('category-color').value;
                const categoryType = document.getElementById('category-type').value; // [ì‹ ê·œ] íƒ€ì… ê°’ ê°€ì ¸ì˜¤ê¸°

                if (categoryIndex) { // ìˆ˜ì •
                    siteData[categoryIndex].category = categoryName;
                    siteData[categoryIndex].color = categoryColor;
                    siteData[categoryIndex].type = categoryType; // [ì‹ ê·œ] íƒ€ì… ì—…ë°ì´íŠ¸
                } else { // ì¶”ê°€
                    siteData.push({ category: categoryName, type: categoryType, sites: [], color: categoryColor });
                }
                saveData();
                hideModals();
            });

            // [ì¶”ê°€] ì œëª© í¼ ì œì¶œ
            titleForm.addEventListener('submit', (e) => {
                e.preventDefault();
                dashboardTitle = document.getElementById('dashboard-title-input').value;
                saveData();
                hideModals();
            });

            // [ì‹ ê·œ] ì´ë²¤íŠ¸ í¼ ì œì¶œ
            document.getElementById('event-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const categoryIndex = document.getElementById('event-category-index').value;
                const eventIndex = document.getElementById('event-index').value;
                const eventType = document.getElementById('event-type').value;

                const eventData = {
                    type: eventType,
                    name: document.getElementById('event-name').value,
                    icon: document.getElementById('event-icon').value,
                    targetDate: eventType === 'dday' 
                        ? document.getElementById('event-date').value 
                        : document.getElementById('event-datetime').value,
                    recurrence: document.getElementById('event-recurrence').value, // [ì‹ ê·œ] ë°˜ë³µ ì •ë³´ ì¶”ê°€
                };

                if (!eventData.targetDate) {
                    showToast('ë‚ ì§œ ë˜ëŠ” ì‹œê°„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                    return;
                }

                if (eventIndex) { // ìˆ˜ì •
                    siteData[categoryIndex].sites[eventIndex] = eventData;
                } else { // ì¶”ê°€
                    siteData[categoryIndex].sites.push(eventData);
                }
                saveData();
                hideModals();
            });

            // --- [ì¶”ê°€] ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ë¦¬ìŠ¤ë„ˆ ---
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼
            document.getElementById('export-btn').addEventListener('click', exportData);
            
            // ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ (ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ì°½ì„ ëŒ€ì‹  í´ë¦­)
            document.getElementById('import-btn').addEventListener('click', () => {
                document.getElementById('import-file-input').click();
            });
            
            // íŒŒì¼ì´ ì‹¤ì œë¡œ ì„ íƒë˜ì—ˆì„ ë•Œ
            document.getElementById('import-file-input').addEventListener('change', importData);
            
            // ê²€ìƒ‰ì°½ ì œì¶œ ì‹œ ì…ë ¥ì°½ ë¹„ìš°ê¸°
            searchForm.addEventListener('submit', () => {
                setTimeout(() => {
                    searchInput.value = '';
                }, 100);
            });
        }


        // --- [ìˆ˜ì •] 3.16 -> 3.17. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (DOM ë¡œë“œ ì™„ë£Œ í›„) ---
        document.addEventListener('DOMContentLoaded', () => {
            loadZoom();             // 0. [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ë ˆë²¨ ë¨¼ì € ë¡œë“œ
            loadFont();             // 0. [í°íŠ¸ ë³€ê²½ ì¶”ê°€] í°íŠ¸ ë¡œë“œ (ì˜êµ¬ ì €ì¥ëœ ê²ƒë§Œ)
            loadData();             // 1. ë°ì´í„° ë¡œë“œ (localStorage ë˜ëŠ” ê¸°ë³¸ê°’)

            // Initial status check for Google Drive
            updateGdriveButtonState(); // [ì¶”ê°€] GDrive ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
            if (localStorage.getItem('gdrive_user_logged_in') === 'true') {
                updateSigninStatus('reauth_needed', 'Google ê³„ì • í™•ì¸ ì¤‘...'); // Assume re-auth needed until silent login succeeds
            } else {
                updateSigninStatus('logged_out');
            }

            renderCards();          // 2. ì¹´ë“œ ë Œë”ë§ (ì—¬ê¸°ì„œ ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ê²Œì´ì…˜ë„ ë Œë”ë§ë¨)
            renderSummaryBoxes();   // [ì‹ ê·œ] ìš”ì•½ ë°•ìŠ¤ ë Œë”ë§
            setupThemeToggle();     // 3. í…Œë§ˆ í† ê¸€ ì„¤ì •
            setupEventListeners();  // 4. [ì¶”ê°€] ëª¨ë“  ì„¤ì • ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í™œì„±í™”
            setupSearchEngine();    // 5. [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„¤ì •
            
            updateTime();           // 6. ìµœì´ˆ ì‹œê°„ í‘œì‹œ
            setInterval(updateTime, 1000); // 7. 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
        });
    </script>
</body>
</html>

