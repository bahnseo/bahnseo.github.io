<!DOCTYPE html>
<html lang="ko" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ í™ˆí˜ì´ì§€ ëŒ€ì‹œë³´ë“œ</title>

    <!-- [ì‹ ê·œ] ë¸Œë¼ìš°ì € íƒ­ ì•„ì´ì½˜ (Favicon) ì¶”ê°€ -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="Icon_32x32-WWW.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <!-- / [ìˆ˜ì •] PNG íŒŒì¼ ì˜ˆì‹œë¡œ ë³€ê²½ -->


    <!-- 1. ê¹œë¹¡ì„ ë°©ì§€ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

    <!-- 2. Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 3. Tailwind ì„¤ì • -->
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
    
    <!-- 4. SortableJS CDN (Drag and Drop) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    
    <style>
        /* Inter í°íŠ¸ ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì ìš© */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ íš¨ê³¼ */
            transition: zoom 0.2s ease-in-out, font-family 0.2s ease-in-out; /* [ìˆ˜ì •] í°íŠ¸ ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜ ì¶”ê°€ */
        }
        /* ë‹¤í¬ ëª¨ë“œ ìŠ¤í¬ë¡¤ë°” */
        .dark ::-webkit-scrollbar { width: 12px; }
        .dark ::-webkit-scrollbar-track { background: #1f2937; }
        .dark ::-webkit-scrollbar-thumb { background-color: #4b5563; border-radius: 6px; border: 3px solid #1f2937; }

        /* [ì¶”ê°€] ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay {
            transition: opacity 0.2s ease-in-out;
        }
        .modal-content {
            transition: transform 0.2s ease-in-out, opacity 0.2s ease-in-out;
        }
        .modal-hidden {
            opacity: 0;
            pointer-events: none;
        }
        .modal-hidden .modal-content {
            transform: scale(0.95);
            opacity: 0;
        }

        /* [ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .toast {
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s 0.5s, opacity 0.5s linear;
        }
        .toast.show {
            visibility: visible;
            opacity: 1;
            transition: opacity 0.5s linear;
        }
        /* [ìˆ˜ì •] í† ìŠ¤íŠ¸ ì—ëŸ¬ ìŠ¤íƒ€ì¼ */
        .toast.error {
            background-color: #dc2626; /* red-600 */
        }

        /* [ì¶”ê°€] ì„¤ì • ëª¨ë“œì¼ ë•Œë§Œ ë³´ì´ëŠ” UI */
        .edit-controls {
            display: none;
        }
        /* [ìˆ˜ì •] .edit-controls-inline ê¸°ë³¸ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .edit-controls-inline {
            display: none;
        }
        .edit-mode .edit-controls {
            display: flex; /* flex ë˜ëŠ” block ë“± */
            flex-direction: column; /* [ì¶”ê°€] for 'flex-col' */
            gap: 1rem; /* [ì¶”ê°€] for 'gap-4' (1rem = 16px) */
        }
        .edit-mode .edit-controls-inline {
            display: inline-flex;
        }
        /* ì„¤ì • ëª¨ë“œì¼ ë•Œ ì¹´ë“œ ìœ„ì— ë²„íŠ¼ í‘œì‹œ */
        .site-card .edit-card-controls {
            display: none;
        }
        .edit-mode .site-card .edit-card-controls {
            display: flex;
        }

        /* [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„ íƒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .search-engine-label {
            background-color: white; /* bg-white */
            color: #374151; /* text-gray-700 */
            transition: all 0.2s ease-in-out;
        }
        .dark .search-engine-label {
            background-color: #374151; /* dark:bg-gray-700 */
            color: #D1D5DB; /* dark:text-gray-300 */
        }
        input[type="radio"]:checked + .search-engine-label {
            background-color: #3B82F6; /* bg-blue-600 */
            color: white; /* text-white */
            border-color: #3B82F6; /* border-blue-600 */
            z-index: 10;
        }
        .dark input[type="radio"]:checked + .search-engine-label {
            background-color: #3B82F6; /* dark:bg-blue-600 */
            color: white; /* dark:text-white */
            border-color: #3B82F6; /* dark:border-blue-600 */
        }

        /* [ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .ghost-category {
            opacity: 0.5;
            background: #e0e7ff; /* indigo-100 */
        }
        .dark .ghost-category {
            background: #3730a3; /* indigo-900 */
        }
        .ghost-card {
            opacity: 0.5;
            background: #dbeafe; /* blue-100 */
        }
        .dark .ghost-card {
            background: #1e3a8a; /* blue-900 */
        }
        .category-title-wrapper.cursor-move {
            cursor: move;
        }
        .site-card.cursor-move {
            cursor: move;
        }

        /* [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ì¶”ê°€] í°íŠ¸ ì„ íƒ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        .font-selector {
            width: 100%;
            padding: 0.75rem 1rem; /* py-3 px-4 */
            border: 1px solid #D1D5DB; /* border-gray-300 */
            background-color: #FFFFFF; /* bg-white */
            color: #1F2937; /* text-gray-900 */
            border-radius: 0.5rem; /* rounded-lg */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm */
            appearance: none; /* ê¸°ë³¸ í™”ì‚´í‘œ ì œê±° */
            /* Tailwind 'chevron-down' icon encoded for data URI */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%236B7280'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem; /* í™”ì‚´í‘œ ê³µê°„ í™•ë³´ */
        }
        .dark .font-selector {
            border-color: #4B5563; /* dark:border-gray-600 */
            background-color: #374151; /* dark:bg-gray-700 */
            color: #F9FAFB; /* dark:text-gray-100 */
            /* Dark mode chevron color */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%23D1D5DB'%3E%3Cpath fill-rule='evenodd' d='M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z' clip-rule='evenodd' /%3E%3C/svg%3E");
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- ì „ì²´ ì»¨í…Œì´ë„ˆ -->
    <div class="min-h-screen container mx-auto px-4 py-8 md:py-12">

        <!-- 1. í—¤ë” ì˜ì—­ -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-8 md:mb-12 gap-4">
            <!-- [ìˆ˜ì •] ëŒ€ì‹œë³´ë“œ ì œëª© ì˜ì—­ -->
            <div class="text-center md:text-left">
                <div class="flex items-center justify-center md:justify-start gap-2">
                    <h1 id="dashboard-title" class="text-3xl font-bold text-blue-600 dark:text-blue-400">My Dashboard</h1>
                    <!-- [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì • ë²„íŠ¼ (ì„¤ì • ëª¨ë“œ) -->
                    <button id="edit-title-btn" class="edit-controls-inline p-1 text-blue-500 hover:text-blue-700" title="ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì •">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                    </button>
                </div>
                <p id="currentTime" class="text-lg text-gray-600 dark:text-gray-400">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div class="flex items-center gap-2 sm:gap-4">
                
                <!-- [ìˆ˜ì •] ê²€ìƒ‰ í¼ ë° ì—”ì§„ ì„ íƒê¸° -->
                <div class="flex flex-col items-end">
                    <!-- [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„ íƒ -->
                    <div class="flex rounded-lg mb-1" role="radiogroup">
                        <input type="radio" id="search-engine-google" name="search-engine" value="google" class="hidden" checked>
                        <!-- [ìˆ˜ì •] padding (py-1.5 -> py-0.5, px-3 -> px-1.5) -->
                        <label for="search-engine-google" class="search-engine-label px-1.5 py-1.0 rounded-l-md border border-gray-300 dark:border-gray-600 cursor-pointer text-xs">google</label>
                        
                        <input type="radio" id="search-engine-naver" name="search-engine" value="naver" class="hidden">
                        <!-- [ìˆ˜ì •] padding (py-1.5 -> py-0.5, px-3 -> px-1.5) -->
                        <label for="search-engine-naver" class="search-engine-label px-1.5 py-1.0 rounded-r-md border border-gray-300 dark:border-gray-600 cursor-pointer -ml-px text-xs">naver</label>
                    </div>
                
                    <!-- [ìˆ˜ì •] ê²€ìƒ‰ í¼ -->
                    <form id="search-form" action="https://www.google.com/search" method="GET" target="_blank" class="flex items-center">
                        <input type="text" id="search-input" name="q" placeholder="Google ê²€ìƒ‰..." class="px-4 py-2 w-36 sm:w-48 md:w-64 border-2 border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 rounded-l-lg focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 dark:focus:border-blue-400">
                        <button type="submit" class="px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-r-lg transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" /></svg>
                        </button>
                    </form>
                </div>

                <!-- [ìˆ˜ì •] í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼ (í—¤ë”ì— ìœ ì§€) -->
                <div class="flex items-center gap-0.5 p-0.5 rounded-lg bg-gray-200 dark:bg-gray-700">
                    <button id="zoom-out-btn" class="p-1 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" title="í™”ë©´ ì¶•ì†Œ">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8zm3 3a1 1 0 011-1h4a1 1 0 110 2H6a1 1 0 01-1-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="zoom-reset-btn" class="px-1.5 py-1 text-xs font-semibold rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors w-12 text-center" title="í™•ëŒ€/ì¶•ì†Œ ì´ˆê¸°í™”">
                        100%
                    </button>
                    <button id="zoom-in-btn" class="p-1 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors" title="í™”ë©´ í™•ëŒ€">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8zm8-3a1 1 0 011 1v2h2a1 1 0 110 2h-2v2a1 1 0 11-2 0v-2H7a1 1 0 110-2h2V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>

                <!-- [ìˆ˜ì •] ì„¤ì •/í…Œë§ˆ ë²„íŠ¼ì€ ì•„ë˜ í”Œë¡œíŒ… ì»¨í…Œì´ë„ˆë¡œ ì´ë™í•˜ê³ , ì´ ìë¦¬ì—ëŠ” ê³µê°„ë§Œ ë‚¨ê¹ë‹ˆë‹¤. -->
                <!-- ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒì„ ìœ„í•´ ì´ ê³µê°„ì€ í•„ìš”í•˜ì§€ ì•Šì„ ìˆ˜ ìˆì§€ë§Œ, ì¼ë‹¨ ë¹„ì›Œë‘¡ë‹ˆë‹¤. -->
                <div class="hidden md:flex items-center gap-2 sm:gap-4">
                    <!-- Placeholder for the space formerly occupied by settings/theme buttons -->
                </div>
            </div>
        </header>

        <!-- 2. ë©”ì¸ ì½˜í…ì¸  - ì¹´ë“œ ê·¸ë¦¬ë“œ -->
        <main id="main-content">
            <!-- JavaScriptë¡œ ì¹´í…Œê³ ë¦¬ì™€ ì¹´ë“œê°€ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤. -->
        </main>

        <!-- [ìˆ˜ì •] ì„¤ì • ëª¨ë“œ ë²„íŠ¼ ì˜ì—­ (Tailwind 'flex' í´ë˜ìŠ¤ ì œê±°) -->
        <div class="edit-controls mt-8">
            <button id="add-category-btn" class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                + ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€
            </button>
            
            <!-- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] -->
            <div>
                <label for="font-selector" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ëŒ€ì‹œë³´ë“œ í°íŠ¸ ë³€ê²½</label>
                <select id="font-selector" class="font-selector focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="default">ê¸°ë³¸ í°íŠ¸ (Inter)</option>
                    <option value="Malgun Gothic">ë§‘ì€ ê³ ë”• (Malgun Gothic)</option>
                    <option value="Gulim">êµ´ë¦¼ (Gulim)</option>
                    <option value="Dotum">ë‹ì›€ (Dotum)</option>
                    <option value="Batang">ë°”íƒ• (Batang)</option>
                    <option value="Gungsuh">ê¶ì„œ (Gungsuh)</option>
                    <option value="Arial">Arial</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Courier New">Courier New</option>
                    <!-- [ìˆ˜ì •] 'ì§ì ‘ ì…ë ¥...'ìœ¼ë¡œ ë³€ê²½ -->
                    <option value="custom">ì§ì ‘ ì…ë ¥...</option>
                </select>
                
                <!-- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ì‚¬ìš©ì ì •ì˜ í°íŠ¸ ì…ë ¥ ì˜ì—­ -->
                <div id="custom-font-container" class="mt-2 hidden"> <!-- [ìˆ˜ì •] space-y-3 ì œê±° -->
                    <!-- 1. ì‹œìŠ¤í…œ í°íŠ¸ ì´ë¦„ ì…ë ¥ (ì˜êµ¬ ì €ì¥) -->
                    <div>
                        <!-- [ìˆ˜ì •] ë¼ë²¨ í…ìŠ¤íŠ¸ ë³€ê²½ -->
                        <label for="custom-font-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì‚¬ìš©ì ì •ì˜ í°íŠ¸ ì´ë¦„</label>
                        <div class="flex gap-2">
                            <input type="text" id="custom-font-input" placeholder="ì˜ˆ: Noto Sans KR" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="apply-custom-font-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì ìš©</button>
                        </div>
                    </div>

                    <!-- [ìˆ˜ì •] í°íŠ¸ íŒŒì¼ ì„ íƒ ê¸°ëŠ¥ ì œê±° -->
                </div>
            </div>

            <!-- [ì¶”ê°€] ê°€ì ¸ì˜¤ê¸° / ë‚´ë³´ë‚´ê¸° -->
            <div class="grid grid-cols-2 gap-4">
                <button id="import-btn" class="w-full py-3 px-4 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-6l-4 4m0 0l-4-4m4 4V3" />
                    </svg>
                    ì„¤ì •/ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                </button>
                <button id="export-btn" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block -mt-1 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v13" />
                    </svg>
                    ì„¤ì •/ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                </button>
            </div>
            <!-- [ì¶”ê°€] ê°€ì ¸ì˜¤ê¸°ìš© ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ -->
            <input type="file" id="import-file-input" class="hidden" accept="application/json">
        </div>
    </div>

    <!-- [ì‹ ê·œ] í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ -->
    <!-- í™”ë©´ ìŠ¤í¬ë¡¤ ì‹œì—ë„ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì— ê³ ì •ë˜ì–´ ë³´ì…ë‹ˆë‹¤. -->
    <div id="floating-actions" class="fixed right-4 bottom-4 z-50 flex flex-col space-y-3">
        <!-- [ì´ë™ëœ] ì„¤ì • ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
        <button id="settings-toggle-btn" class="p-1.5 rounded-full bg-blue-600 dark:bg-blue-500 hover:bg-blue-700 dark:hover:bg-blue-600 text-white shadow-xl transition-colors">
            <svg id="settings-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.573-1.066z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <!-- [ì´ë™ëœ] ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
        <button id="theme-toggle" class="p-1.5 rounded-full bg-gray-700 dark:bg-gray-200 hover:bg-gray-800 dark:hover:bg-gray-300 text-white dark:text-gray-800 shadow-xl transition-colors">
            <svg id="theme-icon-light" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
            <svg id="theme-icon-dark" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
        </button>
    </div>
    
    <!-- [ì¶”ê°€] ì‚¬ì´íŠ¸ ìˆ˜ì •/ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="site-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4 overflow-y-auto max-h-[90vh]">
            <h3 id="site-modal-title" class="text-xl font-semibold mb-4">ì‚¬ì´íŠ¸ í¸ì§‘</h3>
            <form id="site-form">
                <!-- í¼ í•„ë“œ (ì¹´í…Œê³ ë¦¬/ì‚¬ì´íŠ¸ ì¸ë±ìŠ¤ ì €ì¥ìš©) -->
                <input type="hidden" id="category-index">
                <input type="hidden" id="site-index">
                
                <div class="mb-4">
                    <label for="site-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì´ë¦„</label>
                    <input type="text" id="site-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="site-url" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">URL</label>
                    <input type="url" id="site-url" placeholder="https://..." class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="site-icon" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì•„ì´ì½˜ (ì´ëª¨ì§€ ë˜ëŠ” URL)</label>
                    <input type="text" id="site-icon" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- [ì¶”ê°€] íŒŒì¼ ì—…ë¡œë“œ í•„ë“œ -->
                <div class="mb-4">
                    <label for="site-icon-file" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ë˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ (1MB ì´í•˜)</label>
                    <input type="file" id="site-icon-file" accept="image/*" class="w-full text-sm text-gray-500 dark:text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-blue-50 dark:file:bg-blue-900
                        file:text-blue-700 dark:file:text-blue-300
                        hover:file:bg-blue-100 dark:hover:file:bg-blue-800
                    ">
                    <!-- [ì¶”ê°€] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° -->
                    <img id="site-icon-preview" src="" alt="ì•„ì´ì½˜ ë¯¸ë¦¬ë³´ê¸°" class="w-16 h-16 rounded-lg object-cover mt-3 hidden">
                </div>

                <div class="mb-4">
                    <label for="site-description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì„¤ëª…</label>
                    <input type="text" id="site-description" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-site-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì¶”ê°€] ì¹´í…Œê³ ë¦¬ ìˆ˜ì •/ì¶”ê°€ ëª¨ë‹¬ ... -->
    <div id="category-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <h3 id="category-modal-title" class="text-xl font-semibold mb-4">ì¹´í…Œê³ ë¦¬ í¸ì§‘</h3>
            <form id="category-form">
                <input type="hidden" id="edit-category-index">
                
                <div class="mb-4">
                    <label for="category-name" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì¹´í…Œê³ ë¦¬ ì´ë¦„</label>
                    <input type="text" id="category-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-category-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª© ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="title-modal" class="modal-overlay modal-hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm">
        <div class="modal-content bg-white dark:bg-gray-800 w-full max-w-md p-6 rounded-lg shadow-xl m-4">
            <h3 id="title-modal-title" class="text-xl font-semibold mb-4">ëŒ€ì‹œë³´ë“œ ì´ë¦„ ìˆ˜ì •</h3>
            <form id="title-form">
                <div class="mb-4">
                    <label for="dashboard-title-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ëŒ€ì‹œë³´ë“œ ì´ë¦„</label>
                    <input type="text" id="dashboard-title-input" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancel-title-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-800 dark:text-gray-200 rounded-md transition-colors">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md shadow-md transition-colors">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>

    <!-- [ì¶”ê°€] í† ìŠ¤íŠ¸ ì•Œë¦¼ (í”¼ë“œë°±) -->
    <div id="toast" class="toast fixed bottom-10 right-10 bg-green-600 text-white px-5 py-3 rounded-lg shadow-xl">
        ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.
    </div>


    <!-- 3. JavaScript ì˜ì—­ -->
    <script>
        // --- [ì¶”ê°€] 3.1. í™”ë©´ í™•ëŒ€/ì¶•ì†Œ ê¸°ëŠ¥ ---
        let currentZoom = 1.0;
        const ZOOM_STEP = 0.1; // 10%ì”© ì¡°ì ˆ
        const MIN_ZOOM = 0.5;  // ìµœì†Œ 50%
        const MAX_ZOOM = 2.0;  // ìµœëŒ€ 200%

        /**
         * ì§€ì •ëœ ë ˆë²¨ë¡œ í™”ë©´ í™•ëŒ€/ì¶•ì†Œë¥¼ ì ìš©í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
         * @param {number} level - ì ìš©í•  í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨ (ì˜ˆ: 1.0)
         */
        function applyZoom(level) {
            // ë²”ìœ„ ì œí•œ
            currentZoom = Math.max(MIN_ZOOM, Math.min(MAX_ZOOM, level));
            // ì†Œìˆ˜ì  2ìë¦¬ë¡œ ë°˜ì˜¬ë¦¼ (ë¶€ë™ ì†Œìˆ˜ì  ì˜¤ë¥˜ ë°©ì§€)
            currentZoom = Math.round(currentZoom * 100) / 100;
            
            // bodyì˜ zoom ì†ì„± ë³€ê²½
            document.body.style.zoom = currentZoom;
            // localStorageì— ì €ì¥
            localStorage.setItem('dashboardZoomLevel', currentZoom);
            
            // ë¦¬ì…‹ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            const zoomResetBtn = document.getElementById('zoom-reset-btn');
            if (zoomResetBtn) {
                zoomResetBtn.textContent = `${Math.round(currentZoom * 100)}%`;
                // 100%ì¼ ë•Œ ê°•ì¡°
                if (currentZoom === 1.0) {
                    zoomResetBtn.classList.add('text-blue-600', 'dark:text-blue-400');
                } else {
                    zoomResetBtn.classList.remove('text-blue-600', 'dark:text-blue-400');
                }
            }
        }

        /** í™”ë©´ í™•ëŒ€ */
        function zoomIn() {
            applyZoom(currentZoom + ZOOM_STEP);
        }

        /** í™”ë©´ ì¶•ì†Œ */
        function zoomOut() {
            applyZoom(currentZoom - ZOOM_STEP);
        }

        /** í™•ëŒ€/ì¶•ì†Œ ì´ˆê¸°í™” */
        function resetZoom() {
            applyZoom(1.0);
        }

        /** í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í™•ëŒ€/ì¶•ì†Œ ë¹„ìœ¨ ì ìš© */
        function loadZoom() {
            const savedZoom = localStorage.getItem('dashboardZoomLevel');
            applyZoom(parseFloat(savedZoom) || 1.0);
        }

        // --- [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ---

        /**
         * ì§€ì •ëœ í°íŠ¸ë¥¼ bodyì— ì ìš©í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
         * @param {string} fontName - ì ìš©í•  í°íŠ¸ ì´ë¦„
         */
        function applyFont(fontName) {
            // [ìˆ˜ì •] fontNameì´ nullì´ê±°ë‚˜ undefinedì¼ ê²½ìš° 'default'ë¡œ ì²˜ë¦¬
            fontName = fontName || 'default'; 
            
            localStorage.setItem('dashboardFont', fontName);
            
            const customContainer = document.getElementById('custom-font-container');

            if (fontName === 'default') {
                document.body.style.fontFamily = "'Inter', sans-serif";
                if (customContainer) customContainer.classList.add('hidden');
            } else if (fontName === 'custom') {
                // 'ì‚¬ìš©ì ì •ì˜...'ë¥¼ ì„ íƒí•œ ê²½ìš°, ì…ë ¥ í•„ë“œë§Œ ë³´ì—¬ì£¼ê³  í°íŠ¸ëŠ” ë³€ê²½í•˜ì§€ ì•ŠìŒ
                if (customContainer) customContainer.classList.remove('hidden');
            } else {
                // 'Malgun Gothic' ë˜ëŠ” ì‚¬ìš©ì ì…ë ¥ í°íŠ¸
                document.body.style.fontFamily = `'${fontName}', 'Inter', sans-serif`;
                
                // [ìˆ˜ì •] í‘œì¤€ í°íŠ¸ê°€ ì„ íƒë˜ë©´ ì‚¬ìš©ì ì…ë ¥ í•„ë“œë¥¼ ìˆ¨ê¹€
                const fontSelector = document.getElementById('font-selector');
                const standardFonts = Array.from(fontSelector.options).map(opt => opt.value);
                if (standardFonts.includes(fontName) && fontName !== 'custom') {
                     if (customContainer) customContainer.classList.add('hidden');
                }
            }
        }

        /** í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ í°íŠ¸ ì ìš© */
        function loadFont() {
            const savedFont = localStorage.getItem('dashboardFont') || 'default';
            const fontSelector = document.getElementById('font-selector');
            
            // 1. í°íŠ¸ ìŠ¤íƒ€ì¼ ì ìš© (ì˜êµ¬ ì €ì¥ëœ í°íŠ¸ë§Œ)
            applyFont(savedFont);

            // 2. UI(ë“œë¡­ë‹¤ìš´, ì…ë ¥ í•„ë“œ) ìƒíƒœ ë³µì›
            const standardFonts = Array.from(fontSelector.options).map(opt => opt.value);

            if (standardFonts.includes(savedFont)) {
                // ì €ì¥ëœ í°íŠ¸ê°€ í‘œì¤€ ëª©ë¡ì— ìˆìœ¼ë©´, ë“œë¡­ë‹¤ìš´ ê°’ì„ ì„¤ì •
                fontSelector.value = savedFont;
                document.getElementById('custom-font-container').classList.add('hidden');
            } else {
                // í‘œì¤€ ëª©ë¡ì— ì—†ìœ¼ë©´(ì‚¬ìš©ì ì •ì˜ í°íŠ¸ì´ë©´)
                fontSelector.value = 'custom';
                document.getElementById('custom-font-container').classList.remove('hidden');
                document.getElementById('custom-font-input').value = savedFont;
            }
        }

        // --- 3.2 -> 3.3. ì „ì—­ ë³€ìˆ˜ ë° DOM ìš”ì†Œ ì„ íƒ ---
        let siteData = []; // ë°ì´í„°ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
        let dashboardTitle = "My Dashboard"; // [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª©
        let editMode = false; // ì„¤ì • ëª¨ë“œ ìƒíƒœ
        
        // [ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì¸ìŠ¤í„´ìŠ¤
        let categorySortable = null;
        let siteSortables = [];

        const mainContent = document.getElementById('main-content');
        const currentTimeEl = document.getElementById('currentTime');
        // [ìˆ˜ì •] í…Œë§ˆ í† ê¸€ ë²„íŠ¼ ì°¸ì¡°ëŠ” í”Œë¡œíŒ… ì˜ì—­ì˜ ë²„íŠ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const themeToggleBtn = document.getElementById('theme-toggle');
        const lightIcon = document.getElementById('theme-icon-light');
        const darkIcon = document.getElementById('theme-icon-dark');

        // [ìˆ˜ì •] ì„¤ì • ëª¨ë“œ ìš”ì†Œ ì°¸ì¡°ëŠ” í”Œë¡œíŒ… ì˜ì—­ì˜ ë²„íŠ¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        const settingsToggleBtn = document.getElementById('settings-toggle-btn');
        const settingsIcon = document.getElementById('settings-icon');
        const closeIcon = document.getElementById('close-icon');
        const addCategoryBtn = document.getElementById('add-category-btn');
        const dashboardTitleEl = document.getElementById('dashboard-title'); // [ì¶”ê°€]

        // [ì¶”ê°€] ëª¨ë‹¬ ìš”ì†Œ
        const siteModal = document.getElementById('site-modal');
        const siteForm = document.getElementById('site-form');
        const categoryModal = document.getElementById('category-modal');
        const categoryForm = document.getElementById('category-form');
        const titleModal = document.getElementById('title-modal'); // [ì¶”ê°€]
        const titleForm = document.getElementById('title-form'); // [ì¶”ê°€]
        const toastEl = document.getElementById('toast');

        // [ì¶”ê°€] ê²€ìƒ‰ í¼ ìš”ì†Œ
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const searchEngineRadios = document.querySelectorAll('input[name="search-engine"]');


        // --- [ìˆ˜ì •] 3.3 -> 3.4. ë°ì´í„° ê´€ë¦¬ í•¨ìˆ˜ (localStorage) ---
        // [ìˆ˜ì •] ë°ì´í„° ë¡œë“œ ë¡œì§ (ê°ì²´ êµ¬ì¡°ë¡œ ë³€ê²½ ë° ë§ˆì´ê·¸ë ˆì´ì…˜)
        function loadData() {
            let dataString = localStorage.getItem('myDashboardData');
            let needsMigration = false;

            if (!dataString) {
                // 1. ì‹ ê·œ ì‚¬ìš©ì: ê¸°ë³¸ê°’ ì„¤ì •
                siteData = [
                    {
                        category: "ì£¼ìš” í¬í„¸",
                        sites: [
                            { name: "Naver", url: "https://www.naver.com", icon: "ğŸŸ¢", description: "êµ­ë‚´ 1ìœ„ í¬í„¸ ì‚¬ì´íŠ¸" },
                            { name: "Google", url: "https://www.google.com", icon: "ğŸ”µ", description: "ê¸€ë¡œë²Œ ê²€ìƒ‰ ì—”ì§„" },
                        ]
                    },
                    {
                        category: "ê°œë°œ ë„êµ¬",
                        sites: [
                            { name: "GitHub", url: "https://github.com", icon: "ğŸ™", description: "ì½”ë“œ í˜¸ìŠ¤íŒ… í”Œë«í¼" },
                            { name: "Stack Overflow", url: "https://stackoverflow.com", icon: "ğŸ“š", description: "ê°œë°œì Q&A ì»¤ë®¤ë‹ˆí‹°" },
                        ]
                    }
                ];
                dashboardTitle = "My Dashboard";
                needsMigration = true; // ê¸°ë³¸ ë°ì´í„°ë¥¼ localStorageì— ì €ì¥
            } else {
                let data = JSON.parse(dataString);
                
                if (Array.isArray(data)) {
                    // 2. ê¸°ì¡´ ì‚¬ìš©ì (êµ¬ì¡° ë§ˆì´ê·¸ë ˆì´ì…˜): ë°°ì—´ -> ê°ì²´
                    siteData = data;
                    dashboardTitle = "My Dashboard"; // ê¸°ë³¸ ì œëª© ì¶”ê°€
                    needsMigration = true; // ìƒˆ êµ¬ì¡°ë¡œ ì €ì¥
                } else if (typeof data === 'object' && data !== null && data.categories) {
                    // 3. ì •ìƒ ì‚¬ìš©ì (ìƒˆ êµ¬ì¡°)
                    siteData = data.categories;
                    dashboardTitle = data.title || "My Dashboard";
                } else {
                    // 4. ë°ì´í„° ì†ìƒ: ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                    siteData = [];
                    dashboardTitle = "My Dashboard";
                    needsMigration = true;
                }
            }
            
            if (needsMigration) {
                // ë§ˆì´ê·¸ë ˆì´ì…˜ ë˜ëŠ” ì´ˆê¸° ì €ì¥ì„ ìˆ˜í–‰ (saveData()ë¥¼ ì§ì ‘ í˜¸ì¶œí•˜ì§€ ì•ŠìŒ)
                const dataToSave = { title: dashboardTitle, categories: siteData };
                localStorage.setItem('myDashboardData', JSON.stringify(dataToSave));
            }

            dashboardTitleEl.textContent = dashboardTitle; // UIì— ì œëª© ë°˜ì˜
        }

        // [ìˆ˜ì •] ì €ì¥ ë¡œì§ (ê°ì²´ êµ¬ì¡°ë¡œ ì €ì¥, ë Œë”ë§ ì œì–´)
        function saveData(shouldRender = true) {
            const dataToSave = { title: dashboardTitle, categories: siteData };
            localStorage.setItem('myDashboardData', JSON.stringify(dataToSave));
            
            // UI ì—…ë°ì´íŠ¸
            dashboardTitleEl.textContent = dashboardTitle;
            if (shouldRender) {
                renderCards(); 
            }

            showToast("ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }


        /**
         * íŒŒì¼ ì´ë¦„ì— ì‚¬ìš©í•  í˜„ì¬ ì‹œê° ë¬¸ìì—´ (YYYY-MM-DD_HHMMSS)ì„ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function getExportDateTimeString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            
            return `${year}-${month}-${day}_${hours}${minutes}${seconds}`;
        }


        // --- [ì¶”ê°€] 3.4 -> 3.5. ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜ ---
        function exportData() {
            try {
                const dataToExport = {
                    dashboardData: JSON.parse(localStorage.getItem('myDashboardData') || '{}'),
                    theme: localStorage.getItem('theme') || 'light',
                    searchEngine: localStorage.getItem('searchEngine') || 'google',
                    zoomLevel: localStorage.getItem('dashboardZoomLevel') || '1.0',
                    font: localStorage.getItem('dashboardFont') || 'default'
                };
                
                // JSON ë¬¸ìì—´ë¡œ ë³€í™˜ (ì˜ˆì˜ê²Œ í¬ë§·íŒ…)
                const jsonString = JSON.stringify(dataToExport, null, 2);
                // Blob ê°ì²´ ìƒì„±
                const blob = new Blob([jsonString], { type: 'application/json' });
                
                const defaultName = `my-dashboard-backup-${getExportDateTimeString()}.json`;

                // [ìˆ˜ì •] "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" ê¸°ëŠ¥ êµ¬í˜„ (í´ë” ì„ íƒ ê¸°ëŠ¥)
                if ('showSaveFilePicker' in window) {
                    // 1. ìµœì‹  ë¸Œë¼ìš°ì €: "ë‹¤ë¥¸ ì´ë¦„ìœ¼ë¡œ ì €ì¥" ëŒ€í™”ìƒì ì‚¬ìš©
                    window.showSaveFilePicker({
                        suggestedName: defaultName,
                        types: [{
                            description: 'JSON Files',
                            accept: { 'application/json': ['.json'] },
                        }],
                    }).then(async (handle) => {
                        // íŒŒì¼ì— ë°ì´í„° ì“°ê¸°
                        const writable = await handle.createWritable();
                        await writable.write(blob);
                        await writable.close();
                        showToast("íŒŒì¼ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                    }).catch(error => {
                        // ì‚¬ìš©ìê°€ "ì·¨ì†Œ"ë¥¼ ëˆ„ë¥¸ ê²½ìš°
                        if (error.name === 'AbortError') {
                            console.log('File save cancelled by user.');
                            showToast("íŒŒì¼ ì €ì¥ì„ ì·¨ì†Œí–ˆìŠµë‹ˆë‹¤.", false, 1500);
                        } else {
                            // ê¸°íƒ€ ì˜¤ë¥˜
                            console.error("Export failed:", error);
                            showToast("ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (Error: " + error.message + ")", true);
                        }
                    });

                } else {
                    // 2. êµ¬í˜• ë¸Œë¼ìš°ì €: ê¸°ì¡´ì˜ ìë™ ë‹¤ìš´ë¡œë“œ ë°©ì‹ ì‚¬ìš© (í´ë°±)
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = defaultName; // [ìˆ˜ì •] ì‹œê°„ í¬í•¨ íŒŒì¼ëª… ì ìš©
                    document.body.appendChild(a);
                    a.click();

                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showToast("ì„¤ì •ì´ íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤. (ìë™ ë‹¤ìš´ë¡œë“œ)");
                }

            } catch (error) {
                console.error("Export failed:", error);
                showToast("ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
            }
        }


        function importData(e) {
            const file = e.target.files[0];
            if (!file) {
                return;
            }

            const reader = new FileReader();
            
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    // íŒŒì¼ êµ¬ì¡°ê°€ ì˜¬ë°”ë¥¸ì§€ ìµœì†Œí•œìœ¼ë¡œ ê²€ì¦
                    if (importedData && importedData.dashboardData && importedData.theme && importedData.searchEngine) {
                        
                        // ê²€ì¦ í†µê³¼ ì‹œ, ëª¨ë“  ì„¤ì •ì„ localStorageì— ë®ì–´ì”ë‹ˆë‹¤.
                        localStorage.setItem('myDashboardData', JSON.stringify(importedData.dashboardData));
                        localStorage.setItem('theme', importedData.theme);
                        localStorage.setItem('searchEngine', importedData.searchEngine);
                        // [ìˆ˜ì •] í°íŠ¸ ì„¤ì •ë„ í•¨ê»˜ ê°€ì ¸ì˜µë‹ˆë‹¤.
                        localStorage.setItem('dashboardZoomLevel', importedData.zoomLevel || '1.0');
                        localStorage.setItem('dashboardFont', importedData.font || 'default');

                        showToast("ì„¤ì •ì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.");
                        
                        // 1.5ì´ˆ í›„ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ëª¨ë“  ë³€ê²½ì‚¬í•­(í…Œë§ˆ, ê²€ìƒ‰ì—”ì§„, ë°ì´í„°, í™•ëŒ€/ì¶•ì†Œ, í°íŠ¸)ì„ ì ìš©
                        setTimeout(() => {
                            location.reload();
                        }, 1500);

                    } else {
                        showToast("ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.", true);
                    }
                } catch (error) {
                    console.error("Import failed:", error);
                    showToast("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", true);
                } finally {
                    // ë‹¤ìŒì—ë„ ë™ì¼í•œ íŒŒì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì…ë ¥ê°’ ì´ˆê¸°í™”
                    e.target.value = null;
                }
            };
            
            reader.onerror = function() {
                showToast("íŒŒì¼ì„ ì½ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", true);
                e.target.value = null;
            };

            reader.readAsText(file);
        }

        // --- [ìˆ˜ì •] 3.5 -> 3.6. UI í”¼ë“œë°± í•¨ìˆ˜ ---
        function showToast(message, isError = false) {
            toastEl.textContent = message;
            
            if (isError) {
                toastEl.classList.add('error');
                toastEl.classList.remove('bg-green-600');
            } else {
                toastEl.classList.remove('error');
                toastEl.classList.add('bg-green-600');
            }

            toastEl.classList.add('show');
            setTimeout(() => {
                toastEl.classList.remove('show');
                // ìŠ¤íƒ€ì¼ ì›ë³µ
                if (isError) {
                    toastEl.classList.remove('error');
                }
            }, 2500); // 2.5ì´ˆ í›„ ì‚¬ë¼ì§
        }

        // --- [ìˆ˜ì •] 3.6 -> 3.7. ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜ (ìˆ˜ì •) ---
        function renderCards() {
            // [ì¶”ê°€] ë Œë”ë§ ì „, ê¸°ì¡´ì˜ Sortable ì¸ìŠ¤í„´ìŠ¤ ì œê±°
            destroySortable();
            mainContent.innerHTML = ''; // ë©”ì¸ ì½˜í…ì¸  ì´ˆê¸°í™”

            if (siteData.length === 0 && editMode) {
                mainContent.innerHTML = `<p class="text-center text-gray-500 dark:text-gray-400">'ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”.</p>`;
            }

            siteData.forEach((category, categoryIndex) => {
                // 1. ì¹´í…Œê³ ë¦¬ ì„¹ì…˜
                const section = document.createElement('section');
                section.className = 'mb-12';

                // 2. ì¹´í…Œê³ ë¦¬ ì œëª© ì˜ì—­
                const titleWrapper = document.createElement('div');
                // [ì¶”ê°€] ë“œë˜ê·¸ í•¸ë“¤ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
                titleWrapper.className = 'category-title-wrapper flex justify-between items-center mb-4 pb-2 border-b-2 border-blue-500 dark:border-blue-400';
                if (editMode) {
                    titleWrapper.classList.add('cursor-move'); // ì„¤ì • ëª¨ë“œì¼ ë•Œë§Œ ì»¤ì„œ ë³€ê²½
                }
                
                titleWrapper.innerHTML = `
                    <h2 class="text-2xl font-semibold">${category.category}</h2>
                    <div class="edit-controls-inline space-x-2">
                        <button class="add-site-btn p-1 text-green-500 hover:text-green-700" data-category-index="${categoryIndex}" title="ì´ ì¹´í…Œê³ ë¦¬ì— ì‚¬ì´íŠ¸ ì¶”ê°€">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        </button>
                        <button class="edit-category-btn p-1 text-blue-500 hover:text-blue-700" data-category-index="${categoryIndex}" title="ì¹´í…Œê³ ë¦¬ ì´ë¦„ ìˆ˜ì •">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                        </button>
                        <button class="delete-category-btn p-1 text-red-500 hover:text-red-700" data-category-index="${categoryIndex}" title="ì¹´í…Œê³ ë¦¬ ì‚­ì œ">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                `;
                section.appendChild(titleWrapper);

                // 3. ì¹´ë“œ ê·¸ë¦¬ë“œ
                const grid = document.createElement('div');
                // [ì¶”ê°€] ë“œë˜ê·¸ ì•¤ ë“œë¡­ íƒ€ê²Ÿì„ ìœ„í•œ í´ë˜ìŠ¤ ë° data ì†ì„± ì¶”ê°€
                grid.className = 'card-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6';
                grid.dataset.categoryIndex = categoryIndex;

                if (category.sites.length === 0 && editMode) {
                     grid.innerHTML = `<p class="text-sm text-gray-500 dark:text-gray-400">'ì‚¬ì´íŠ¸ ì¶”ê°€' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì´ ì¹´í…Œê³ ë¦¬ì— ì²« ì‚¬ì´íŠ¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</p>`;
                }

                // 4. ê° ì‚¬ì´íŠ¸ ì¹´ë“œ ìƒì„±
                category.sites.forEach((site, siteIndex) => {
                    const card = document.createElement('a');
                    card.href = site.url;
                    card.target = '_blank';
                    card.rel = 'noopener noreferrer';
                    card.className = `
                        site-card relative block p-5 bg-white dark:bg-gray-800 
                        rounded-xl shadow-md hover:shadow-lg dark:hover:shadow-gray-700/50 
                        transition-all duration-300 transform hover:scale-[1.03]
                    `;
                    // [ì¶”ê°€] ì„¤ì • ëª¨ë“œì¼ ë•Œ ì»¤ì„œ ë³€ê²½
                    if (editMode) {
                        card.classList.add('cursor-move');
                    }

                    card.innerHTML = `
                        <!-- [ì¶”ê°€] ì¹´ë“œ í¸ì§‘ ë²„íŠ¼ -->
                        <div class="edit-card-controls absolute top-2 right-2 space-x-1">
                            <button class="edit-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-blue-600 hover:text-blue-800"
                                    data-category-index="${categoryIndex}" data-site-index="${siteIndex}" title="ì‚¬ì´íŠ¸ ìˆ˜ì •">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" /></svg>
                            </button>
                            <button class="delete-site-btn p-1.5 bg-white dark:bg-gray-700 rounded-full shadow-md text-red-600 hover:text-red-800"
                                    data-category-index="${categoryIndex}" data-site-index="${siteIndex}" title="ì‚¬ì´íŠ¸ ì‚­ì œ">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>

                        <div class="flex items-center space-x-4">
                            ${(site.icon && (site.icon.startsWith('data:image') || site.icon.startsWith('http')))
                                // [ìˆ˜ì •] ì´ë¯¸ì§€ URL ë˜ëŠ” Base64ì¼ ê²½ìš° <img> íƒœê·¸ ë Œë”ë§
                                ? `<img src="${site.icon}" alt="${site.name} icon" class="flex-shrink-0 w-10 h-10 rounded-lg object-cover">`
                                // [ìˆ˜ì •] ê·¸ ì™¸ (ì´ëª¨ì§€ ë“±)
                                : `<span class="flex-shrink-0 text-3xl w-10 h-10 flex items-center justify-center">${site.icon || 'ğŸŒ'}</span>`
                            }
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-100">${site.name}</h3>
                                <p class="text-sm text-gray-600 dark:text-gray-400">${site.description}</p>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });

                section.appendChild(grid);
                mainContent.appendChild(section);
            });

            // [ì¶”ê°€] ë Œë”ë§ ì™„ë£Œ í›„, ì„¤ì • ëª¨ë“œë¼ë©´ Sortable í™œì„±í™”
            if (editMode) {
                initSortable();
            }
        }

        // --- [ìˆ˜ì •] 3.7 -> 3.8. ì‹¤ì‹œê°„ ì‹œê³„ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function updateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false };
            currentTimeEl.textContent = now.toLocaleString('ko-KR', options);
        }

        // --- [ìˆ˜ì •] 3.8 -> 3.9. í…Œë§ˆ í† ê¸€ í•¨ìˆ˜ (ê¸°ì¡´) ---
        function setupThemeToggle() {
            function updateIcon() {
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden'); darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden'); darkIcon.classList.remove('hidden');
                }
            }
            themeToggleBtn.addEventListener('click', () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.theme = isDark ? 'dark' : 'light';
                updateIcon();
            });
            updateIcon(); // ì´ˆê¸° ì•„ì´ì½˜ ì„¤ì •
        }

        // --- [ìˆ˜ì •] 3.9 -> 3.10. ê²€ìƒ‰ ì—”ì§„ ì„¤ì • í•¨ìˆ˜ ---
        function updateSearchEngine(engine) {
            if (engine === 'google') {
                searchForm.action = 'https://www.google.com/search';
                searchInput.name = 'q';
                searchInput.placeholder = 'Google ê²€ìƒ‰...';
            } else if (engine === 'naver') {
                searchForm.action = 'https://search.naver.com/search.naver';
                searchInput.name = 'query';
                searchInput.placeholder = 'Naver ê²€ìƒ‰...';
            }
            localStorage.setItem('searchEngine', engine);
        }

        function setupSearchEngine() {
            searchEngineRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    updateSearchEngine(e.target.value);
                });
            });
            
            const savedEngine = localStorage.getItem('searchEngine') || 'google';
            document.getElementById(`search-engine-${savedEngine}`).checked = true;
            updateSearchEngine(savedEngine);
        }


        // --- [ìˆ˜ì •] 3.10 -> 3.11. ëª¨ë‹¬ ê´€ë¦¬ í•¨ìˆ˜ ---
        function showSiteModal(categoryIndex, siteIndex = null) {
            siteForm.reset(); // í¼ ì´ˆê¸°í™”
            document.getElementById('category-index').value = categoryIndex;
            
            // [ì¶”ê°€] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            const preview = document.getElementById('site-icon-preview');
            preview.classList.add('hidden');
            preview.src = '';
            // [ì¶”ê°€] íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
            document.getElementById('site-icon-file').value = '';

            if (siteIndex !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                document.getElementById('site-modal-title').textContent = "ì‚¬ì´íŠ¸ ìˆ˜ì •";
                document.getElementById('site-index').value = siteIndex;
                const site = siteData[categoryIndex].sites[siteIndex];
                document.getElementById('site-name').value = site.name;
                document.getElementById('site-url').value = site.url;
                document.getElementById('site-icon').value = site.icon;
                document.getElementById('site-description').value = site.description;

                // [ì¶”ê°€] ë¯¸ë¦¬ë³´ê¸°ê°€ Base64 ì´ë¯¸ì§€ì´ê±°ë‚˜ URLì´ë©´ í‘œì‹œ
                if (site.icon && (site.icon.startsWith('data:image') || site.icon.startsWith('http'))) {
                    preview.src = site.icon;
                    preview.classList.remove('hidden');
                }

            } else {
                // ì¶”ê°€ ëª¨ë“œ
                // [ìˆ˜ì •] 'site-modal-title'ì„ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
                document.getElementById('site-modal-title').textContent = "ìƒˆ ì‚¬ì´íŠ¸ ì¶”ê°€";
                // [ìˆ˜ì •] 'site-index'ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
                document.getElementById('site-index').value = ''; // ì¸ë±ìŠ¤ ë¹„ìš°ê¸°
            }
            // [ìˆ˜ì •] 'siteModal'ì„ ì˜¬ë°”ë¥´ê²Œ ì°¸ì¡°
            siteModal.classList.remove('modal-hidden');
        }

        // [ìˆ˜ì •] ëˆ„ë½ë˜ì—ˆë˜ showCategoryModal í•¨ìˆ˜ ì¶”ê°€
        function showCategoryModal(categoryIndex = null) {
            categoryForm.reset();
            if (categoryIndex !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                document.getElementById('category-modal-title').textContent = "ì¹´í…Œê³ ë¦¬ ìˆ˜ì •";
                document.getElementById('edit-category-index').value = categoryIndex;
                document.getElementById('category-name').value = siteData[categoryIndex].category;
            } else {
                // ì¶”ê°€ ëª¨ë“œ
                document.getElementById('category-modal-title').textContent = "ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€";
                document.getElementById('edit-category-index').value = '';
            }
            categoryModal.classList.remove('modal-hidden');
        }

        // [ì¶”ê°€] ì œëª© ìˆ˜ì • ëª¨ë‹¬ í‘œì‹œ
        function showTitleModal() {
            document.getElementById('dashboard-title-input').value = dashboardTitle;
            titleModal.classList.remove('modal-hidden');
        }

        function hideModals() {
            siteModal.classList.add('modal-hidden');
            categoryModal.classList.add('modal-hidden');
            titleModal.classList.add('modal-hidden'); // [ì¶”ê°€]
        }

        // --- [ìˆ˜ì •] 3.11 -> 3.12. ì„¤ì • ëª¨ë“œ í† ê¸€ ---
        function toggleSettings() {
            editMode = !editMode;
            document.body.classList.toggle('edit-mode');
            
            // ì•„ì´ì½˜ ì „í™˜
            settingsIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');

            // ì„¤ì • ëª¨ë“œì¼ ë•Œ ì¹´ë“œ ë§í¬ ë¹„í™œì„±í™” (í´ë¦­ ë°©ì§€)
            const cards = document.querySelectorAll('.site-card');
            cards.forEach(card => {
                card.style.pointerEvents = editMode ? 'none' : 'auto';
            });
            
            // [ìˆ˜ì •] ë Œë”ë§ì„ ë‹¤ì‹œ í˜¸ì¶œí•˜ì—¬ Sortable ì¸ìŠ¤í„´ìŠ¤ ë“±ì„ ê°±ì‹ 
            renderCards();
        }

        // --- [ì¶”ê°€] 3.12 -> 3.13. ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì •ë ¬ í•¨ìˆ˜ ---
        function initSortable() {
            // 1. ì¹´í…Œê³ ë¦¬ ì •ë ¬
            categorySortable = new Sortable(mainContent, {
                animation: 150,
                handle: '.category-title-wrapper', // ì¹´í…Œê³ ë¦¬ ì œëª© ì˜ì—­ì„ í•¸ë“¤ë¡œ ì‚¬ìš©
                ghostClass: 'ghost-category',
                onEnd: (evt) => {
                    // siteData ë°°ì—´ ìˆœì„œ ë³€ê²½
                    const item = siteData.splice(evt.oldIndex, 1)[0];
                    siteData.splice(evt.newIndex, 0, item);
                    
                    // ì €ì¥ ë° í™”ë©´ ë‹¤ì‹œ ë Œë”ë§ (ì¸ë±ìŠ¤ ë™ê¸°í™”)
                    saveData(true);
                }
            });

            // 2. ê° ì¹´í…Œê³ ë¦¬ ë‚´ ì‚¬ì´íŠ¸ ì¹´ë“œ ì •ë ¬
            document.querySelectorAll('.card-grid').forEach((grid) => {
                const s = new Sortable(grid, {
                    animation: 150,
                    group: 'sites', // ì¹´í…Œê³ ë¦¬ ê°„ ì¹´ë“œ ì´ë™ í—ˆìš©
                    ghostClass: 'ghost-card',
                    onEnd: (evt) => {
                        const fromCategoryIndex = evt.from.dataset.categoryIndex;
                        const toCategoryIndex = evt.to.dataset.categoryIndex;
                        const oldIndex = evt.oldDraggableIndex;
                        const newIndex = evt.newDraggableIndex;

                        // 1. ê¸°ì¡´ ì¹´í…Œê³ ë¦¬ì—ì„œ ì•„ì´í…œ ì œê±°
                        const item = siteData[fromCategoryIndex].sites.splice(oldIndex, 1)[0];
                        // 2. ìƒˆ ì¹´í…Œê³ ë¦¬ì— ì•„ì´í…œ ì¶”ê°€
                        siteData[toCategoryIndex].sites.splice(newIndex, 0, item);

                        // ì €ì¥ ë° í™”ë©´ ë‹¤ì‹œ ë Œë”ë§ (ì¸ë±ìŠ¤ ë™ê¸°í™”)
                        saveData(true);
                    }
                });
                siteSortables.push(s);
            });
        }

        function destroySortable() {
            if (categorySortable) {
                categorySortable.destroy();
                categorySortable = null;
            }
            siteSortables.forEach(s => s.destroy());
            siteSortables = [];
        }


        // --- [ìˆ˜ì •] 3.13 -> 3.14. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        function setupEventListeners() {
            // [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ë²„íŠ¼
            document.getElementById('zoom-in-btn').addEventListener('click', zoomIn);
            document.getElementById('zoom-out-btn').addEventListener('click', zoomOut);
            document.getElementById('zoom-reset-btn').addEventListener('click', resetZoom);

            // [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •]
            document.getElementById('font-selector').addEventListener('change', (e) => {
                const selectedFont = e.target.value;
                applyFont(selectedFont); // [ìˆ˜ì •] ë“œë¡­ë‹¤ìš´ ì„ íƒì€ ì˜êµ¬ ì €ì¥
                if (selectedFont !== 'custom' && selectedFont !== 'default') {
                    showToast(`í°íŠ¸ê°€ '${selectedFont}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else if (selectedFont === 'default') {
                    showToast(`ê¸°ë³¸ í°íŠ¸ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            });

            // [í°íŠ¸ ë³€ê²½ ê¸°ëŠ¥ ìˆ˜ì •] ì‹œìŠ¤í…œ í°íŠ¸ 'ì ìš©' ë²„íŠ¼ ë¦¬ìŠ¤ë„ˆ (ì˜êµ¬ ì €ì¥)
            document.getElementById('apply-custom-font-btn').addEventListener('click', (e) => {
                e.preventDefault();
                const customFontName = document.getElementById('custom-font-input').value.trim();
                if (customFontName) {
                    applyFont(customFontName); // [ìˆ˜ì •] í°íŠ¸ ì ìš© ë° ì˜êµ¬ ì €ì¥
                    showToast(`ì‹œìŠ¤í…œ í°íŠ¸ '${customFontName}'(ì´)ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    showToast('í°íŠ¸ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                }
            });

            // ì„¤ì • ëª¨ë“œ í† ê¸€
            settingsToggleBtn.addEventListener('click', toggleSettings);

            // [ì¶”ê°€] ëŒ€ì‹œë³´ë“œ ì œëª© ìˆ˜ì • ë²„íŠ¼
            document.getElementById('edit-title-btn').addEventListener('click', showTitleModal);

            // ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ ì´ë²¤íŠ¸ ìœ„ì„ (ë™ì ìœ¼ë¡œ ìƒì„±ëœ ë²„íŠ¼ ì²˜ë¦¬)
            mainContent.addEventListener('click', (e) => {
                // ì„¤ì • ëª¨ë“œì¼ ë•Œë§Œ ë²„íŠ¼ì´ ë³´ì´ë¯€ë¡œ, editMode ì²´í¬ëŠ” ë¶ˆí•„ìš”
                
                // ì¹´ë“œ ë§í¬ í´ë¦­ ë°©ì§€ (ì„¤ì • ëª¨ë“œì¼ ë•Œ)
                if (editMode && e.target.closest('a.site-card')) {
                    e.preventDefault();
                }

                const addSiteBtn = e.target.closest('.add-site-btn');
                const editCategoryBtn = e.target.closest('.edit-category-btn');
                const deleteCategoryBtn = e.target.closest('.delete-category-btn');
                const editSiteBtn = e.target.closest('.edit-site-btn');
                const deleteSiteBtn = e.target.closest('.delete-site-btn');

                if (addSiteBtn) {
                    e.preventDefault();
                    showSiteModal(addSiteBtn.dataset.categoryIndex);
                } 
                else if (editCategoryBtn) {
                    e.preventDefault();
                    showCategoryModal(editCategoryBtn.dataset.categoryIndex);
                } 
                else if (deleteCategoryBtn) {
                    e.preventDefault();
                    const index = deleteCategoryBtn.dataset.categoryIndex;
                    if (confirm(`'${siteData[index].category}' ì¹´í…Œê³ ë¦¬ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\ní¬í•¨ëœ ëª¨ë“  ì‚¬ì´íŠ¸ê°€ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
                        siteData.splice(index, 1);
                        saveData();
                    }
                } 
                else if (editSiteBtn) {
                    e.preventDefault();
                    showSiteModal(editSiteBtn.dataset.categoryIndex, editSiteBtn.dataset.siteIndex);
                } 
                else if (deleteSiteBtn) {
                    e.preventDefault();
                    const catIndex = deleteSiteBtn.dataset.categoryIndex;
                    const siteIndex = deleteSiteBtn.dataset.siteIndex;
                    if (confirm(`'${siteData[catIndex].sites[siteIndex].name}' ì‚¬ì´íŠ¸ë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                        siteData[catIndex].sites.splice(siteIndex, 1);
                        saveData();
                    }
                }
            });

            // ìƒˆ ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ë²„íŠ¼
            addCategoryBtn.addEventListener('click', () => {
                showCategoryModal(); // ì¸ë±ìŠ¤ ì—†ì´ í˜¸ì¶œ (ì¶”ê°€ ëª¨ë“œ)
            });

            // ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼
            document.getElementById('cancel-site-btn').addEventListener('click', hideModals);
            document.getElementById('cancel-category-btn').addEventListener('click', hideModals);
            document.getElementById('cancel-title-btn').addEventListener('click', hideModals); // [ì¶”ê°€]
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
            siteModal.addEventListener('click', (e) => {
                if (e.target === siteModal) hideModals();
            });
            categoryModal.addEventListener('click', (e) => {
                if (e.target === categoryModal) hideModals();
            });
            titleModal.addEventListener('click', (e) => { // [ì¶”ê°€]
                if (e.target === titleModal) hideModals();
            });

            // [ì¶”ê°€] íŒŒì¼ ì…ë ¥ ë³€ê²½ ì´ë²¤íŠ¸ (FileReaderë¡œ Base64 ì¸ì½”ë”©)
            document.getElementById('site-icon-file').addEventListener('change', (e) => {
                const file = e.target.files[0];
                const preview = document.getElementById('site-icon-preview');
                const iconInput = document.getElementById('site-icon');

                if (!file) {
                    return;
                }

                // íŒŒì¼ í¬ê¸° ì œí•œ (1MB)
                if (file.size > 1024 * 1024) {
                    showToast('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤ (1MB ì´í•˜).', true);
                    e.target.value = ''; // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    // Base64 ë°ì´í„°ë¥¼ í…ìŠ¤íŠ¸ ì…ë ¥ì°½ì— ì„¤ì •
                    iconInput.value = dataUrl;
                    // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì„¤ì •
                    preview.src = dataUrl;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            });

            // ì‚¬ì´íŠ¸ í¼ ì œì¶œ
            siteForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const categoryIndex = document.getElementById('category-index').value;
                const siteIndex = document.getElementById('site-index').value;
                
                const site = {
                    name: document.getElementById('site-name').value,
                    url: document.getElementById('site-url').value,
                    icon: document.getElementById('site-icon').value,
                    description: document.getElementById('site-description').value,
                };

                if (siteIndex) { // ìˆ˜ì •
                    siteData[categoryIndex].sites[siteIndex] = site;
                } else { // ì¶”ê°€
                    siteData[categoryIndex].sites.push(site);
                }
                saveData();
                hideModals();
            });

            // ì¹´í…Œê³ ë¦¬ í¼ ì œì¶œ
            categoryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const categoryIndex = document.getElementById('edit-category-index').value;
                const categoryName = document.getElementById('category-name').value;

                if (categoryIndex) { // ìˆ˜ì •
                    siteData[categoryIndex].category = categoryName;
                } else { // ì¶”ê°€
                    siteData.push({ category: categoryName, sites: [] });
                }
                saveData();
                hideModals();
            });

            // [ì¶”ê°€] ì œëª© í¼ ì œì¶œ
            titleForm.addEventListener('submit', (e) => {
                e.preventDefault();
                dashboardTitle = document.getElementById('dashboard-title-input').value;
                saveData();
                hideModals();
            });

            // --- [ì¶”ê°€] ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ë¦¬ìŠ¤ë„ˆ ---
            
            // ë‚´ë³´ë‚´ê¸° ë²„íŠ¼
            document.getElementById('export-btn').addEventListener('click', exportData);
            
            // ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ (ìˆ¨ê²¨ì§„ íŒŒì¼ ì…ë ¥ì°½ì„ ëŒ€ì‹  í´ë¦­)
            document.getElementById('import-btn').addEventListener('click', () => {
                document.getElementById('import-file-input').click();
            });
            
            // íŒŒì¼ì´ ì‹¤ì œë¡œ ì„ íƒë˜ì—ˆì„ ë•Œ
            document.getElementById('import-file-input').addEventListener('change', importData);
            
            // ê²€ìƒ‰ì°½ ì œì¶œ ì‹œ ì…ë ¥ì°½ ë¹„ìš°ê¸°
            searchForm.addEventListener('submit', () => {
                setTimeout(() => {
                    searchInput.value = '';
                }, 100);
            });
        }


        // --- [ìˆ˜ì •] 3.14 -> 3.15. ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (DOM ë¡œë“œ ì™„ë£Œ í›„) ---
        document.addEventListener('DOMContentLoaded', () => {
            loadZoom();             // 0. [ì¶”ê°€] í™•ëŒ€/ì¶•ì†Œ ë ˆë²¨ ë¨¼ì € ë¡œë“œ
            loadFont();             // 0. [í°íŠ¸ ë³€ê²½ ì¶”ê°€] í°íŠ¸ ë¡œë“œ (ì˜êµ¬ ì €ì¥ëœ ê²ƒë§Œ)
            loadData();             // 1. ë°ì´í„° ë¡œë“œ (localStorage ë˜ëŠ” ê¸°ë³¸ê°’)
            renderCards();          // 2. ì¹´ë“œ ë Œë”ë§
            setupThemeToggle();     // 3. í…Œë§ˆ í† ê¸€ ì„¤ì •
            setupEventListeners();  // 4. [ì¶”ê°€] ëª¨ë“  ì„¤ì • ê´€ë ¨ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í™œì„±í™”
            setupSearchEngine();    // 5. [ì¶”ê°€] ê²€ìƒ‰ ì—”ì§„ ì„¤ì •
            
            updateTime();           // 6. ìµœì´ˆ ì‹œê°„ í‘œì‹œ
            setInterval(updateTime, 1000); // 7. 1ì´ˆë§ˆë‹¤ ì‹œê°„ ì—…ë°ì´íŠ¸
        });
    </script>
</body>
</html>
